'use strict';const _0x131783=_0x8e76;(function(_0x545fdc,_0x1d718b){const _0x272b69=_0x8e76,_0x1d7385=_0x545fdc();while(!![]){try{const _0x18f5e5=-parseInt(_0x272b69(0xa8))/0x1+parseInt(_0x272b69(0x87))/0x2+-parseInt(_0x272b69(0x9f))/0x3*(parseInt(_0x272b69(0x8a))/0x4)+parseInt(_0x272b69(0x7d))/0x5*(-parseInt(_0x272b69(0xb8))/0x6)+parseInt(_0x272b69(0xa1))/0x7+parseInt(_0x272b69(0xb2))/0x8+parseInt(_0x272b69(0x8b))/0x9;if(_0x18f5e5===_0x1d718b)break;else _0x1d7385['push'](_0x1d7385['shift']());}catch(_0x7771c1){_0x1d7385['push'](_0x1d7385['shift']());}}}(_0x182f,0xa5a10));var __awaiter=this&&this['__awaiter']||function(_0x154e2f,_0x298432,_0x1d280f,_0x390583){function _0x17df1b(_0x3f0c46){return _0x3f0c46 instanceof _0x1d280f?_0x3f0c46:new _0x1d280f(function(_0x4c9415){_0x4c9415(_0x3f0c46);});}return new(_0x1d280f||(_0x1d280f=Promise))(function(_0x1863d8,_0x48b93e){const _0x223998=_0x8e76;function _0xb22024(_0x433f4f){try{_0x104289(_0x390583['next'](_0x433f4f));}catch(_0x2609e1){_0x48b93e(_0x2609e1);}}function _0x5988f1(_0x530eab){const _0xf9b275=_0x8e76;try{_0x104289(_0x390583[_0xf9b275(0x83)](_0x530eab));}catch(_0x1e40bc){_0x48b93e(_0x1e40bc);}}function _0x104289(_0x4a3646){const _0x44cf27=_0x8e76;_0x4a3646[_0x44cf27(0x80)]?_0x1863d8(_0x4a3646[_0x44cf27(0x73)]):_0x17df1b(_0x4a3646[_0x44cf27(0x73)])['then'](_0xb22024,_0x5988f1);}_0x104289((_0x390583=_0x390583[_0x223998(0x82)](_0x154e2f,_0x298432||[]))['next']());});},__importDefault=this&&this[_0x131783(0xb7)]||function(_0x4c61e7){return _0x4c61e7&&_0x4c61e7['__esModule']?_0x4c61e7:{'default':_0x4c61e7};};Object['defineProperty'](exports,_0x131783(0xbb),{'value':!![]}),exports[_0x131783(0x79)]=exports[_0x131783(0xb6)]=exports['getAuthorization']=void 0x0;const permission_model_1=__importDefault(require('../models/permission.model')),isJWT_1=__importDefault(require('validator/lib/isJWT')),tokens_model_1=__importDefault(require(_0x131783(0xaf))),constants_1=require(_0x131783(0x96)),users_model_1=__importDefault(require(_0x131783(0xae))),user_entity_1=__importDefault(require(_0x131783(0xa4))),jwt=require(_0x131783(0xb3)),getAuthorization=(_0x3db30d,_0x2da163,_0x107089)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x485a7d=_0x131783,_0x6a632c=_0x3db30d[_0x485a7d(0x92)](_0x485a7d(0x76));try{if(!_0x6a632c)return _0x2da163[_0x485a7d(0xb5)]({'message':_0x485a7d(0xa0),'refreshToken1':!![]});if(!(0x0,isJWT_1[_0x485a7d(0x89)])(_0x6a632c))return _0x2da163[_0x485a7d(0xb5)]({'message':_0x485a7d(0xa7),'refreshToken1':!![]});const _0x6c3e2b=yield tokens_model_1[_0x485a7d(0x89)][_0x485a7d(0x88)]({'token':_0x6a632c});if(!_0x6c3e2b)return _0x2da163[_0x485a7d(0xb5)]({'message':_0x485a7d(0xa2),'refreshToken1':!![]});const _0x42907d=jwt[_0x485a7d(0x9c)](_0x6a632c,constants_1[_0x485a7d(0x68)]),_0x1dc521=yield users_model_1[_0x485a7d(0x89)]['findById'](_0x42907d['id']);if(!_0x1dc521)return _0x2da163['json']({'message':_0x485a7d(0x6f),'refreshToken1':!![]});return _0x3db30d[_0x485a7d(0xab)]=_0x1dc521,_0x3db30d[_0x485a7d(0x6c)]=_0x1dc521[_0x485a7d(0x78)],_0x107089();}catch(_0x3e86e5){return console[_0x485a7d(0x99)]('authorization\x20error'),console[_0x485a7d(0x99)](_0x3e86e5),_0x2da163['json']({'message':_0x485a7d(0x8c),'refreshToken1':!![]});}});function _0x182f(){const _0x4895f4=['filter','x-auth-token','/admin','_id','hasPermissionDashboard','/error/403','split','انبار','4035VfTlHb','/auth','isUserLoggedIn','done','دستگاه‌ها','apply','throw','baseUrl','userPhone','status','908134mCXuto','findOne','default','876nLoHcy','19577052uujYXr','Token\x20is\x20not\x20valid!7','length','admin','permission\x20denied','routes','fullName','header','find','charAt','get','../utility/constants','user.svg','inside\x20site\x20permission\x20middle\x20\x20ware','error','locals','path','decode','پیشخوان','dashboard','5652wxiwWd','Token\x20is\x20not\x20valid!1','506702TWqhNB','Token\x20is\x20not\x20valid3','redirect','../entities/user.entity','route','initialRoute','Token\x20is\x20not\x20valid!2','1295686fYfvCO','includes','devices','userDetails','substring','profile-2user.svg','../models/users.model','../models/tokens.model','log','element-4.svg','5801920HGFyWN','jsonwebtoken','/client','json','hasPermission','__importDefault','7734fHaDXr','storehouse','/dashboard','__esModule','###############################','***********','session','jsonWebTokenSecretKey','role','user','3d-cube-scan.svg','userId','دسترسی\x20غیر\x20مجاز','cpu.svg','Token\x20is\x20not\x20valid!6','toUpperCase','fuuuuuuuuuuuuuuuuuuck','method','value','phoneNumber'];_0x182f=function(){return _0x4895f4;};return _0x182f();}function _0x8e76(_0x1f4cc5,_0x24a605){const _0x182f45=_0x182f();return _0x8e76=function(_0x8e76b0,_0x57159d){_0x8e76b0=_0x8e76b0-0x67;let _0x345cfe=_0x182f45[_0x8e76b0];return _0x345cfe;},_0x8e76(_0x1f4cc5,_0x24a605);}exports['getAuthorization']=getAuthorization;const hasPermission=(_0x412b7a,_0x90426a,_0x1d65a9)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x4f1f2c=_0x131783;try{const {userDetails:_0x49ccf3}=_0x412b7a;if(!_0x49ccf3)return _0x90426a[_0x4f1f2c(0x86)](0x194)[_0x4f1f2c(0xb5)]({'message':_0x4f1f2c(0x8f)});let _0x51efaf=null;_0x412b7a[_0x4f1f2c(0x9b)][_0x4f1f2c(0x94)](0x0)==='/'?_0x51efaf=_0x412b7a[_0x4f1f2c(0x84)]+_0x412b7a[_0x4f1f2c(0x9b)]:_0x51efaf=_0x412b7a[_0x4f1f2c(0x84)]+'/'+_0x412b7a[_0x4f1f2c(0x9b)];const _0x4a9dd6=_0x412b7a[_0x4f1f2c(0x72)];_0x51efaf[_0x51efaf['length']-0x1]==='/'&&(_0x51efaf=_0x51efaf[_0x4f1f2c(0xac)](0x0,_0x51efaf[_0x4f1f2c(0x8d)]-0x1));const _0x2c241=yield permission_model_1[_0x4f1f2c(0x89)]['findOne']({'role':_0x49ccf3[_0x4f1f2c(0x69)]});console[_0x4f1f2c(0xb0)](_0x4f1f2c(0xbd)),console['log'](_0x51efaf),console['log'](_0x4a9dd6);return _0x1d65a9();const _0x1b8c5d=_0x2c241===null||_0x2c241===void 0x0?void 0x0:_0x2c241[_0x4f1f2c(0x95)](_0x4a9dd6[_0x4f1f2c(0x70)]())[_0x4f1f2c(0x93)](_0x46e2f8=>{const _0x34038b=new RegExp(_0x46e2f8);return _0x34038b['test'](_0x51efaf);});console[_0x4f1f2c(0xb0)](_0x1b8c5d),console[_0x4f1f2c(0xb0)]({'hasPermission':_0x1b8c5d,'path':_0x51efaf,'method':_0x4a9dd6});if(!_0x1b8c5d)return console[_0x4f1f2c(0xb0)](_0x4f1f2c(0x71)),_0x90426a[_0x4f1f2c(0x86)](0x194)['json']({'message':_0x4f1f2c(0x8f)});return _0x1d65a9();}catch(_0x2c94b4){return console['error']('inside\x20permission\x20middle\x20\x20ware'),console[_0x4f1f2c(0x99)](_0x2c94b4),_0x90426a[_0x4f1f2c(0x86)](0x1f4)[_0x4f1f2c(0xb5)]({'message':'خطایی\x20پیش\x20آمده!'});}});exports['hasPermission']=hasPermission;const hasPermissionDashboard=(_0x4f65b4,_0x95398,_0x15a0ba)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x155e52=_0x131783;try{if(!_0x4f65b4[_0x155e52(0x67)][_0x155e52(0x7f)])return _0x95398[_0x155e52(0xa3)](_0x155e52(0x7e));const _0x26cbec=_0x4f65b4['session'][_0x155e52(0x85)],_0x3a478a=yield user_entity_1[_0x155e52(0x89)]['getUserInformationWithPhoneNumber'](_0x26cbec);if(!_0x3a478a)return _0x4f65b4[_0x155e52(0x67)][_0x155e52(0x7f)]=![],_0x95398[_0x155e52(0xa3)]('/auth');if(_0x3a478a[_0x155e52(0x69)]==_0x155e52(0x6a))return _0x95398[_0x155e52(0xa3)](_0x155e52(0x7a));let _0x58072a=null;_0x4f65b4[_0x155e52(0x9b)][_0x155e52(0x94)](0x0)==='/'?_0x58072a=_0x4f65b4[_0x155e52(0x84)]+_0x4f65b4['path']:_0x58072a=_0x4f65b4[_0x155e52(0x84)]+'/'+_0x4f65b4[_0x155e52(0x9b)];const _0xc0b1ba=_0x4f65b4[_0x155e52(0x72)];_0x58072a[_0x58072a['length']-0x1]==='/'&&(_0x58072a=_0x58072a[_0x155e52(0xac)](0x0,_0x58072a['length']-0x1));const _0xd46156=yield permission_model_1[_0x155e52(0x89)][_0x155e52(0x88)]({'role':_0x3a478a['role']});if(!_0xd46156)return _0x95398[_0x155e52(0xa3)](_0x155e52(0x7e));const _0x9fd507=_0xd46156[_0x155e52(0x95)](_0xc0b1ba[_0x155e52(0x70)]())[_0x155e52(0x93)](_0x19533a=>{const _0x5e347e=new RegExp(_0x19533a);return _0x5e347e['test'](_0x58072a);});if(!_0x9fd507)return _0xc0b1ba[_0x155e52(0x70)]()=='GET'&&_0x95398[_0x155e52(0xa3)](_0xd46156[_0x155e52(0xa6)]),_0x95398['json']({'status':![],'message':_0x155e52(0x6d)});_0x4f65b4['user']=_0x3a478a,_0x95398[_0x155e52(0x9a)]['userName']=_0x3a478a[_0x155e52(0x91)][_0x155e52(0x7b)]('\x20')[0x0],_0x95398[_0x155e52(0x9a)][_0x155e52(0x91)]=_0x3a478a['fullName'],_0x95398[_0x155e52(0x9a)]['phoneNumber']=_0x3a478a[_0x155e52(0x74)],_0x95398[_0x155e52(0x9a)][_0x155e52(0x69)]=_0x3a478a[_0x155e52(0x69)];const _0x42431e=[{'route':'/','title':_0x155e52(0x9d),'image':_0x155e52(0xb1),'name':_0x155e52(0x9e)},{'route':_0x155e52(0x77),'title':'مدیران','image':_0x155e52(0x97),'name':_0x155e52(0x8e)},{'route':_0x155e52(0xb4),'title':'مشتریان','image':_0x155e52(0xad),'name':'client'},{'route':'/devices','title':_0x155e52(0x81),'image':_0x155e52(0x6e),'name':_0x155e52(0xaa)},{'route':'/store_room','title':_0x155e52(0x7c),'image':_0x155e52(0x6b),'name':_0x155e52(0xb9)}];return console[_0x155e52(0xb0)](_0x155e52(0xbc)),_0x95398[_0x155e52(0x9a)][_0x155e52(0x90)]=_0x42431e[_0x155e52(0x75)](_0x26042a=>{const _0x23720a=_0x155e52,_0x456ce4=_0x26042a['route']=='/'?_0x23720a(0xba):_0x23720a(0xba)+_0x26042a[_0x23720a(0xa5)];return _0xd46156===null||_0xd46156===void 0x0?void 0x0:_0xd46156['get'](_0xc0b1ba[_0x23720a(0x70)]())[_0x23720a(0xa9)](_0x456ce4);}),console[_0x155e52(0xb0)](_0x95398[_0x155e52(0x9a)][_0x155e52(0x90)]),_0x15a0ba();}catch(_0x39cf65){return console[_0x155e52(0x99)](_0x155e52(0x98)),console[_0x155e52(0x99)](_0x39cf65),_0x95398[_0x155e52(0x86)](0x1f4)[_0x155e52(0xb5)]({'message':'خطایی\x20پیش\x20آمده!'});}});exports[_0x131783(0x79)]=hasPermissionDashboard;