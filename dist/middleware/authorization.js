'use strict';const _0x10bd1f=_0x4504;(function(_0x32bd88,_0x14973f){const _0xa2086a=_0x4504,_0x37e192=_0x32bd88();while(!![]){try{const _0x5e2dd8=-parseInt(_0xa2086a(0x187))/0x1+-parseInt(_0xa2086a(0x1a6))/0x2+-parseInt(_0xa2086a(0x1d3))/0x3+-parseInt(_0xa2086a(0x1d1))/0x4*(parseInt(_0xa2086a(0x189))/0x5)+parseInt(_0xa2086a(0x198))/0x6+parseInt(_0xa2086a(0x195))/0x7*(parseInt(_0xa2086a(0x1a8))/0x8)+parseInt(_0xa2086a(0x196))/0x9;if(_0x5e2dd8===_0x14973f)break;else _0x37e192['push'](_0x37e192['shift']());}catch(_0x5a0d5c){_0x37e192['push'](_0x37e192['shift']());}}}(_0x6bda,0xe2e25));var __awaiter=this&&this[_0x10bd1f(0x1ce)]||function(_0x536f94,_0x2e5cd7,_0x7b72bb,_0x501342){function _0x5c83a4(_0x405b05){return _0x405b05 instanceof _0x7b72bb?_0x405b05:new _0x7b72bb(function(_0x293468){_0x293468(_0x405b05);});}return new(_0x7b72bb||(_0x7b72bb=Promise))(function(_0x260c72,_0x5ce64a){const _0x4e9ce8=_0x4504;function _0x1ea1c1(_0x2c2918){try{_0x39da8c(_0x501342['next'](_0x2c2918));}catch(_0xb36835){_0x5ce64a(_0xb36835);}}function _0x1d0212(_0x1fd855){try{_0x39da8c(_0x501342['throw'](_0x1fd855));}catch(_0x282120){_0x5ce64a(_0x282120);}}function _0x39da8c(_0xb5997c){const _0x531295=_0x4504;_0xb5997c[_0x531295(0x1a2)]?_0x260c72(_0xb5997c[_0x531295(0x190)]):_0x5c83a4(_0xb5997c[_0x531295(0x190)])[_0x531295(0x1b3)](_0x1ea1c1,_0x1d0212);}_0x39da8c((_0x501342=_0x501342[_0x4e9ce8(0x19e)](_0x536f94,_0x2e5cd7||[]))[_0x4e9ce8(0x1c4)]());});},__importDefault=this&&this['__importDefault']||function(_0xe5f3f2){const _0x5d6afa=_0x10bd1f;return _0xe5f3f2&&_0xe5f3f2[_0x5d6afa(0x1c5)]?_0xe5f3f2:{'default':_0xe5f3f2};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[_0x10bd1f(0x1b6)]=exports[_0x10bd1f(0x19a)]=exports[_0x10bd1f(0x197)]=void 0x0;const permission_model_1=__importDefault(require('../models/permission.model')),isJWT_1=__importDefault(require(_0x10bd1f(0x1aa))),tokens_model_1=__importDefault(require(_0x10bd1f(0x1bc))),constants_1=require(_0x10bd1f(0x1a4)),users_model_1=__importDefault(require('../models/users.model')),user_entity_1=__importDefault(require(_0x10bd1f(0x1bd))),jwt=require('jsonwebtoken'),getAuthorization=(_0x449eb5,_0x3fec4e,_0x28c463)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x3bc938=_0x10bd1f,_0x422bdc=_0x449eb5[_0x3bc938(0x192)]('x-auth-token');try{if(!_0x422bdc)return _0x3fec4e[_0x3bc938(0x1ab)]({'message':_0x3bc938(0x1d4),'refreshToken1':!![]});if(!(0x0,isJWT_1[_0x3bc938(0x1ac)])(_0x422bdc))return _0x3fec4e[_0x3bc938(0x1ab)]({'message':_0x3bc938(0x1dc),'refreshToken1':!![]});const _0x46e571=yield tokens_model_1[_0x3bc938(0x1ac)][_0x3bc938(0x1de)]({'token':_0x422bdc});if(!_0x46e571)return _0x3fec4e[_0x3bc938(0x1ab)]({'message':_0x3bc938(0x18e),'refreshToken1':!![]});const _0x48300a=jwt[_0x3bc938(0x1bf)](_0x422bdc,constants_1[_0x3bc938(0x1be)]),_0x5ccbf1=yield users_model_1[_0x3bc938(0x1ac)][_0x3bc938(0x19b)](_0x48300a['id']);if(!_0x5ccbf1)return _0x3fec4e[_0x3bc938(0x1ab)]({'message':_0x3bc938(0x1ae),'refreshToken1':!![]});return _0x449eb5[_0x3bc938(0x1a7)]=_0x5ccbf1,_0x449eb5[_0x3bc938(0x1a5)]=_0x5ccbf1['_id'],_0x28c463();}catch(_0x170707){return console[_0x3bc938(0x1ba)](_0x3bc938(0x1d2)),console['error'](_0x170707),_0x3fec4e['json']({'message':_0x3bc938(0x1af),'refreshToken1':!![]});}});function _0x4504(_0x3d3855,_0x2c87c0){const _0x6bda50=_0x6bda();return _0x4504=function(_0x4504d9,_0x23a4af){_0x4504d9=_0x4504d9-0x187;let _0x12fe05=_0x6bda50[_0x4504d9];return _0x12fe05;},_0x4504(_0x3d3855,_0x2c87c0);}exports[_0x10bd1f(0x197)]=getAuthorization;const hasPermission=(_0x5d7604,_0x53677f,_0x2a9930)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x4ec0e0=_0x10bd1f;try{const {userDetails:_0x15b130}=_0x5d7604;if(!_0x15b130)return _0x53677f[_0x4ec0e0(0x1cf)](0x194)['json']({'message':_0x4ec0e0(0x1c7)});let _0x1e8f8c=null;_0x5d7604[_0x4ec0e0(0x1ca)]['charAt'](0x0)==='/'?_0x1e8f8c=_0x5d7604[_0x4ec0e0(0x1bb)]+_0x5d7604[_0x4ec0e0(0x1ca)]:_0x1e8f8c=_0x5d7604['baseUrl']+'/'+_0x5d7604[_0x4ec0e0(0x1ca)];const _0x63f323=_0x5d7604['method'];_0x1e8f8c[_0x1e8f8c[_0x4ec0e0(0x1d8)]-0x1]==='/'&&(_0x1e8f8c=_0x1e8f8c[_0x4ec0e0(0x1d9)](0x0,_0x1e8f8c[_0x4ec0e0(0x1d8)]-0x1));const _0x3b205c=yield permission_model_1[_0x4ec0e0(0x1ac)][_0x4ec0e0(0x1de)]({'role':_0x15b130[_0x4ec0e0(0x1d5)]}),_0x2e3b4e=_0x3b205c===null||_0x3b205c===void 0x0?void 0x0:_0x3b205c[_0x4ec0e0(0x1a0)](_0x63f323[_0x4ec0e0(0x1b5)]())[_0x4ec0e0(0x1df)](_0x5c0033=>{const _0x38e423=_0x4ec0e0,_0xb44d8e=new RegExp(_0x5c0033);return _0xb44d8e[_0x38e423(0x1a3)](_0x1e8f8c);});if(!_0x2e3b4e)return _0x53677f[_0x4ec0e0(0x1cf)](0x194)['json']({'message':'permission\x20denied'});return _0x2a9930();}catch(_0x252259){return console[_0x4ec0e0(0x1ba)](_0x4ec0e0(0x1db)),console['error'](_0x252259),_0x53677f[_0x4ec0e0(0x1cf)](0x1f4)[_0x4ec0e0(0x1ab)]({'message':'خطایی\x20پیش\x20آمده!'});}});function _0x6bda(){const _0x22981e=['element-4.svg','value','storehouse','header','isUserLoggedIn','خطایی\x20پیش\x20آمده!','24094rUEwPC','40250331ovnyVh','getAuthorization','3796458wudKcH','devices','hasPermission','findById','getUserInformationWithPhoneNumber','/dashboard/admin','apply','charAt','get','userName','done','test','../utility/constants','userId','2786364svMqyH','userDetails','3664WxiyCI','routes','validator/lib/isJWT','json','default','مشتریان','Token\x20is\x20not\x20valid!6','Token\x20is\x20not\x20valid!7','پیشخوان','user','/dashboard/devices','then','initialRoute','toUpperCase','hasPermissionDashboard','/dashboard','user.svg','cpu.svg','error','baseUrl','../models/tokens.model','../entities/user.entity','jsonWebTokenSecretKey','verify','انبار','method','client','/dashboard/store_room','next','__esModule','GET','permission\x20denied','locals','redirect','path','userPhone','fullName','inside\x20site\x20permission\x20middle\x20\x20ware','__awaiter','status','/dashboard/auth','5033276wVeTkr','authorization\x20error','5135247vbcPgq','Token\x20is\x20not\x20valid!1','role','session','مدیران','length','substring','filter','inside\x20permission\x20middle\x20\x20ware','Token\x20is\x20not\x20valid!2','3d-cube-scan.svg','findOne','find','1388871CRbSYn','route','5JjnYtM','split','phoneNumber','includes','dashboard','Token\x20is\x20not\x20valid3'];_0x6bda=function(){return _0x22981e;};return _0x6bda();}exports[_0x10bd1f(0x19a)]=hasPermission;const hasPermissionDashboard=(_0x95c0ae,_0x577653,_0x32160d)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x4d258e=_0x10bd1f;try{if(!_0x95c0ae[_0x4d258e(0x1d6)]['isUserLoggedIn'])return _0x577653[_0x4d258e(0x1c9)](_0x4d258e(0x1d0));const _0x4e5735=_0x95c0ae[_0x4d258e(0x1d6)][_0x4d258e(0x1cb)],_0x11de93=yield user_entity_1[_0x4d258e(0x1ac)][_0x4d258e(0x19c)](_0x4e5735);if(!_0x11de93)return _0x95c0ae[_0x4d258e(0x1d6)][_0x4d258e(0x193)]=![],_0x577653[_0x4d258e(0x1c9)]('/dashboard/auth');if(_0x11de93[_0x4d258e(0x1d5)]==_0x4d258e(0x1b1))return _0x577653[_0x4d258e(0x1c9)]('/error/403');let _0x21e9fe=null;_0x95c0ae[_0x4d258e(0x1ca)][_0x4d258e(0x19f)](0x0)==='/'?_0x21e9fe=_0x95c0ae[_0x4d258e(0x1bb)]+_0x95c0ae[_0x4d258e(0x1ca)]:_0x21e9fe=_0x95c0ae[_0x4d258e(0x1bb)]+'/'+_0x95c0ae[_0x4d258e(0x1ca)];const _0x289027=_0x95c0ae[_0x4d258e(0x1c1)];_0x21e9fe[_0x21e9fe[_0x4d258e(0x1d8)]-0x1]==='/'&&(_0x21e9fe=_0x21e9fe[_0x4d258e(0x1d9)](0x0,_0x21e9fe[_0x4d258e(0x1d8)]-0x1));const _0x4c9bbd=yield permission_model_1['default'][_0x4d258e(0x1de)]({'role':_0x11de93['role']});if(!_0x4c9bbd)return _0x577653['redirect']('/dashboard/auth');const _0x36aa53=_0x4c9bbd['get'](_0x289027[_0x4d258e(0x1b5)]())[_0x4d258e(0x1df)](_0x13b767=>{const _0x227793=_0x4d258e,_0x3996f2=new RegExp(_0x13b767);return _0x3996f2[_0x227793(0x1a3)](_0x21e9fe);});if(!_0x36aa53)return _0x289027['toUpperCase']()==_0x4d258e(0x1c6)&&_0x577653[_0x4d258e(0x1c9)](_0x4c9bbd[_0x4d258e(0x1b4)]),_0x577653[_0x4d258e(0x1ab)]({'status':![],'message':'دسترسی\x20غیر\x20مجاز'});_0x95c0ae['user']=_0x11de93,_0x577653[_0x4d258e(0x1c8)][_0x4d258e(0x1a1)]=_0x11de93[_0x4d258e(0x1cc)][_0x4d258e(0x18a)]('\x20')[0x0],_0x577653['locals'][_0x4d258e(0x1cc)]=_0x11de93[_0x4d258e(0x1cc)],_0x577653[_0x4d258e(0x1c8)][_0x4d258e(0x18b)]=_0x11de93[_0x4d258e(0x18b)],_0x577653[_0x4d258e(0x1c8)][_0x4d258e(0x1d5)]=_0x11de93[_0x4d258e(0x1d5)];const _0x5c9912=[{'route':_0x4d258e(0x1b7),'title':_0x4d258e(0x1b0),'image':_0x4d258e(0x18f),'name':_0x4d258e(0x18d)},{'route':_0x4d258e(0x19d),'title':_0x4d258e(0x1d7),'image':_0x4d258e(0x1b8),'name':'admin'},{'route':'/dashboard/client','title':_0x4d258e(0x1ad),'image':'profile-2user.svg','name':_0x4d258e(0x1c2)},{'route':_0x4d258e(0x1b2),'title':'دستگاه‌ها','image':_0x4d258e(0x1b9),'name':_0x4d258e(0x199)},{'route':_0x4d258e(0x1c3),'title':_0x4d258e(0x1c0),'image':_0x4d258e(0x1dd),'name':_0x4d258e(0x191)}];return _0x577653[_0x4d258e(0x1c8)][_0x4d258e(0x1a9)]=_0x5c9912[_0x4d258e(0x1da)](_0x37a6c2=>_0x4c9bbd===null||_0x4c9bbd===void 0x0?void 0x0:_0x4c9bbd[_0x4d258e(0x1a0)](_0x289027[_0x4d258e(0x1b5)]())[_0x4d258e(0x18c)](_0x37a6c2[_0x4d258e(0x188)])),_0x32160d();}catch(_0x4a09f9){return console[_0x4d258e(0x1ba)](_0x4d258e(0x1cd)),console[_0x4d258e(0x1ba)](_0x4a09f9),_0x577653['status'](0x1f4)[_0x4d258e(0x1ab)]({'message':_0x4d258e(0x194)});}});exports[_0x10bd1f(0x1b6)]=hasPermissionDashboard;