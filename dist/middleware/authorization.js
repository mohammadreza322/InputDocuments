'use strict';const _0x149acd=_0x8da9;(function(_0x1809d4,_0x18caa3){const _0x5bd454=_0x8da9,_0xdea204=_0x1809d4();while(!![]){try{const _0x4ac0ed=-parseInt(_0x5bd454(0xb5))/0x1+-parseInt(_0x5bd454(0xd5))/0x2+parseInt(_0x5bd454(0xef))/0x3*(-parseInt(_0x5bd454(0xd3))/0x4)+parseInt(_0x5bd454(0xc4))/0x5*(-parseInt(_0x5bd454(0xeb))/0x6)+parseInt(_0x5bd454(0xc3))/0x7*(parseInt(_0x5bd454(0xff))/0x8)+-parseInt(_0x5bd454(0xd0))/0x9+parseInt(_0x5bd454(0xd2))/0xa*(parseInt(_0x5bd454(0xcb))/0xb);if(_0x4ac0ed===_0x18caa3)break;else _0xdea204['push'](_0xdea204['shift']());}catch(_0x2ddbd3){_0xdea204['push'](_0xdea204['shift']());}}}(_0x3c02,0x5a685));var __awaiter=this&&this[_0x149acd(0xe6)]||function(_0x315279,_0x1f1bb7,_0x3a1c20,_0x44c400){function _0xd61c76(_0x4f1c9a){return _0x4f1c9a instanceof _0x3a1c20?_0x4f1c9a:new _0x3a1c20(function(_0x2ae358){_0x2ae358(_0x4f1c9a);});}return new(_0x3a1c20||(_0x3a1c20=Promise))(function(_0x34cf5e,_0xd7a049){const _0x2ec78e=_0x8da9;function _0x27df3e(_0x30cae7){const _0x2f6e92=_0x8da9;try{_0x4e9384(_0x44c400[_0x2f6e92(0xf4)](_0x30cae7));}catch(_0x45dd54){_0xd7a049(_0x45dd54);}}function _0x2dca34(_0x3fe6ad){const _0x3eb4ff=_0x8da9;try{_0x4e9384(_0x44c400[_0x3eb4ff(0xd4)](_0x3fe6ad));}catch(_0x1bc743){_0xd7a049(_0x1bc743);}}function _0x4e9384(_0x17c300){const _0x40e675=_0x8da9;_0x17c300[_0x40e675(0x105)]?_0x34cf5e(_0x17c300[_0x40e675(0xd6)]):_0xd61c76(_0x17c300['value'])[_0x40e675(0xfe)](_0x27df3e,_0x2dca34);}_0x4e9384((_0x44c400=_0x44c400[_0x2ec78e(0xd9)](_0x315279,_0x1f1bb7||[]))['next']());});},__importDefault=this&&this['__importDefault']||function(_0x1974f0){return _0x1974f0&&_0x1974f0['__esModule']?_0x1974f0:{'default':_0x1974f0};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[_0x149acd(0xae)]=exports[_0x149acd(0xbc)]=exports['getAuthorization']=void 0x0;const permission_model_1=__importDefault(require(_0x149acd(0xe0))),isJWT_1=__importDefault(require(_0x149acd(0xbe))),tokens_model_1=__importDefault(require(_0x149acd(0xdd))),constants_1=require(_0x149acd(0xfd)),users_model_1=__importDefault(require(_0x149acd(0xf5))),user_entity_1=__importDefault(require('../entities/user.entity')),jwt=require(_0x149acd(0xfa)),getAuthorization=(_0x2d05b4,_0x25eb54,_0x2072bd)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x4c9865=_0x149acd,_0x8ac849=_0x2d05b4[_0x4c9865(0xea)](_0x4c9865(0x100));try{if(!_0x8ac849)return _0x25eb54['json']({'message':'Token\x20is\x20not\x20valid!1','refreshToken1':!![]});if(!(0x0,isJWT_1['default'])(_0x8ac849))return _0x25eb54[_0x4c9865(0xc2)]({'message':_0x4c9865(0xf8),'refreshToken1':!![]});const _0x25e056=yield tokens_model_1[_0x4c9865(0xbb)][_0x4c9865(0xb0)]({'token':_0x8ac849});if(!_0x25e056)return _0x25eb54['json']({'message':_0x4c9865(0xe7),'refreshToken1':!![]});const _0x1d654b=jwt[_0x4c9865(0xcc)](_0x8ac849,constants_1[_0x4c9865(0xc9)]),_0x34b215=yield users_model_1[_0x4c9865(0xbb)][_0x4c9865(0xe1)](_0x1d654b['id']);if(!_0x34b215)return _0x25eb54[_0x4c9865(0xc2)]({'message':_0x4c9865(0xe2),'refreshToken1':!![]});return _0x2d05b4[_0x4c9865(0xc1)]=_0x34b215,_0x2d05b4['userId']=_0x34b215['_id'],_0x2072bd();}catch(_0x344eb2){return console[_0x4c9865(0x103)](_0x4c9865(0xcf)),console[_0x4c9865(0x103)](_0x344eb2),_0x25eb54['json']({'message':_0x4c9865(0x107),'refreshToken1':!![]});}});function _0x3c02(){const _0x25f71f=['../models/permission.model','findById','Token\x20is\x20not\x20valid!6','length','path','storehouse','__awaiter','Token\x20is\x20not\x20valid3','element-4.svg','دسترسی\x20غیر\x20مجاز','header','12ZuhfcA','admin','dashboard','method','117336vepkNu','split','client','toUpperCase','getAuthorization','next','../models/users.model','redirect','phoneNumber','Token\x20is\x20not\x20valid!2','test','jsonwebtoken','baseUrl','find','../utility/constants','then','8htLyUe','x-auth-token','پیشخوان','مدیران','error','substring','done','charAt','Token\x20is\x20not\x20valid!7','hasPermissionDashboard','filter','findOne','routes','session','/admin','خطایی\x20پیش\x20آمده!','421123ohtUbY','status','role','log','userPhone','/dashboard','default','hasPermission','/devices','validator/lib/isJWT','user','devices','userDetails','json','4993163PIVKeq','1539515wKwPNC','/error/403','profile-2user.svg','isUserLoggedIn','###############################','jsonWebTokenSecretKey','locals','18613969GxlGBX','decode','cpu.svg','/auth','authorization\x20error','1226187myuCdI','مشتریان','10dZCaFM','32rEqTKq','throw','1098222pHLcKP','value','fullName','permission\x20denied','apply','***********','انبار','دستگاه‌ها','../models/tokens.model','fuuuuuuuuuuuuuuuuuuck','/client'];_0x3c02=function(){return _0x25f71f;};return _0x3c02();}exports[_0x149acd(0xf3)]=getAuthorization;const hasPermission=(_0x3f9ea8,_0x46c4fb,_0x4b305c)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x48797d=_0x149acd;try{const {userDetails:_0x22bd74}=_0x3f9ea8;if(!_0x22bd74)return _0x46c4fb['status'](0x194)[_0x48797d(0xc2)]({'message':_0x48797d(0xd8)});let _0x35db40=null;_0x3f9ea8[_0x48797d(0xe4)][_0x48797d(0x106)](0x0)==='/'?_0x35db40=_0x3f9ea8['baseUrl']+_0x3f9ea8[_0x48797d(0xe4)]:_0x35db40=_0x3f9ea8[_0x48797d(0xfb)]+'/'+_0x3f9ea8[_0x48797d(0xe4)];const _0xc32e36=_0x3f9ea8[_0x48797d(0xee)];_0x35db40[_0x35db40[_0x48797d(0xe3)]-0x1]==='/'&&(_0x35db40=_0x35db40[_0x48797d(0x104)](0x0,_0x35db40['length']-0x1));const _0x1e0ff8=yield permission_model_1[_0x48797d(0xbb)]['findOne']({'role':_0x22bd74[_0x48797d(0xb7)]});console[_0x48797d(0xb8)](_0x48797d(0xda)),console[_0x48797d(0xb8)](_0x35db40),console[_0x48797d(0xb8)](_0xc32e36);return _0x4b305c();const _0x2a4e4e=_0x1e0ff8===null||_0x1e0ff8===void 0x0?void 0x0:_0x1e0ff8['get'](_0xc32e36[_0x48797d(0xf2)]())[_0x48797d(0xfc)](_0x138e1d=>{const _0x4cb1ec=_0x48797d,_0x3d03af=new RegExp(_0x138e1d);return _0x3d03af[_0x4cb1ec(0xf9)](_0x35db40);});console[_0x48797d(0xb8)](_0x2a4e4e),console[_0x48797d(0xb8)]({'hasPermission':_0x2a4e4e,'path':_0x35db40,'method':_0xc32e36});if(!_0x2a4e4e)return console['log'](_0x48797d(0xde)),_0x46c4fb[_0x48797d(0xb6)](0x194)[_0x48797d(0xc2)]({'message':_0x48797d(0xd8)});return _0x4b305c();}catch(_0x5a901a){return console[_0x48797d(0x103)]('inside\x20permission\x20middle\x20\x20ware'),console[_0x48797d(0x103)](_0x5a901a),_0x46c4fb[_0x48797d(0xb6)](0x1f4)[_0x48797d(0xc2)]({'message':_0x48797d(0xb4)});}});exports[_0x149acd(0xbc)]=hasPermission;const hasPermissionDashboard=(_0xf14346,_0x35841c,_0x180df8)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x576e46=_0x149acd;try{if(!_0xf14346[_0x576e46(0xb2)]['isUserLoggedIn'])return _0x35841c[_0x576e46(0xf6)]('/auth');const _0x1ec77a=_0xf14346[_0x576e46(0xb2)][_0x576e46(0xb9)],_0x1c250d=yield user_entity_1['default']['getUserInformationWithPhoneNumber'](_0x1ec77a);if(!_0x1c250d)return _0xf14346[_0x576e46(0xb2)][_0x576e46(0xc7)]=![],_0x35841c[_0x576e46(0xf6)](_0x576e46(0xce));if(_0x1c250d[_0x576e46(0xb7)]==_0x576e46(0xbf))return _0x35841c[_0x576e46(0xf6)](_0x576e46(0xc5));let _0x3f6203=null;_0xf14346[_0x576e46(0xe4)][_0x576e46(0x106)](0x0)==='/'?_0x3f6203=_0xf14346[_0x576e46(0xfb)]+_0xf14346[_0x576e46(0xe4)]:_0x3f6203=_0xf14346[_0x576e46(0xfb)]+'/'+_0xf14346[_0x576e46(0xe4)];const _0x469e7f=_0xf14346[_0x576e46(0xee)];_0x3f6203[_0x3f6203[_0x576e46(0xe3)]-0x1]==='/'&&(_0x3f6203=_0x3f6203[_0x576e46(0x104)](0x0,_0x3f6203[_0x576e46(0xe3)]-0x1));const _0x596a3b=yield permission_model_1[_0x576e46(0xbb)][_0x576e46(0xb0)]({'role':_0x1c250d[_0x576e46(0xb7)]});if(!_0x596a3b)return _0x35841c[_0x576e46(0xf6)]('/auth');const _0x21a9f2=_0x596a3b['get'](_0x469e7f[_0x576e46(0xf2)]())[_0x576e46(0xfc)](_0x3f8613=>{const _0x3d27d8=_0x576e46,_0x15f9fb=new RegExp(_0x3f8613);return _0x15f9fb[_0x3d27d8(0xf9)](_0x3f6203);});if(!_0x21a9f2)return _0x469e7f[_0x576e46(0xf2)]()=='GET'&&_0x35841c['redirect'](_0x596a3b['initialRoute']),_0x35841c[_0x576e46(0xc2)]({'status':![],'message':_0x576e46(0xe9)});_0xf14346[_0x576e46(0xbf)]=_0x1c250d,_0x35841c['locals']['userName']=_0x1c250d[_0x576e46(0xd7)][_0x576e46(0xf0)]('\x20')[0x0],_0x35841c[_0x576e46(0xca)][_0x576e46(0xd7)]=_0x1c250d[_0x576e46(0xd7)],_0x35841c[_0x576e46(0xca)][_0x576e46(0xf7)]=_0x1c250d[_0x576e46(0xf7)],_0x35841c[_0x576e46(0xca)][_0x576e46(0xb7)]=_0x1c250d['role'];const _0x2e4b0a=[{'route':'/','title':_0x576e46(0x101),'image':_0x576e46(0xe8),'name':_0x576e46(0xed)},{'route':_0x576e46(0xb3),'title':_0x576e46(0x102),'image':'user.svg','name':_0x576e46(0xec)},{'route':_0x576e46(0xdf),'title':_0x576e46(0xd1),'image':_0x576e46(0xc6),'name':_0x576e46(0xf1)},{'route':_0x576e46(0xbd),'title':_0x576e46(0xdc),'image':_0x576e46(0xcd),'name':_0x576e46(0xc0)},{'route':'/store_room','title':_0x576e46(0xdb),'image':'3d-cube-scan.svg','name':_0x576e46(0xe5)}];return console[_0x576e46(0xb8)](_0x576e46(0xc8)),_0x35841c[_0x576e46(0xca)][_0x576e46(0xb1)]=_0x2e4b0a[_0x576e46(0xaf)](_0x217c19=>{const _0x45628a=_0x576e46,_0x18e901=_0x217c19['route']=='/'?'/dashboard':_0x45628a(0xba)+_0x217c19['route'];return _0x596a3b===null||_0x596a3b===void 0x0?void 0x0:_0x596a3b['get'](_0x469e7f['toUpperCase']())['includes'](_0x18e901);}),console[_0x576e46(0xb8)](_0x35841c[_0x576e46(0xca)][_0x576e46(0xb1)]),_0x180df8();}catch(_0x487159){return console[_0x576e46(0x103)]('inside\x20site\x20permission\x20middle\x20\x20ware'),console[_0x576e46(0x103)](_0x487159),_0x35841c['status'](0x1f4)[_0x576e46(0xc2)]({'message':'خطایی\x20پیش\x20آمده!'});}});function _0x8da9(_0xb50f99,_0x53f075){const _0x3c0212=_0x3c02();return _0x8da9=function(_0x8da95a,_0x2f4ff2){_0x8da95a=_0x8da95a-0xae;let _0x3fe5c7=_0x3c0212[_0x8da95a];return _0x3fe5c7;},_0x8da9(_0xb50f99,_0x53f075);}exports[_0x149acd(0xae)]=hasPermissionDashboard;