'use strict';const _0x30fdb5=_0xe93f;(function(_0x13f627,_0x36aeb5){const _0x54342f=_0xe93f,_0x1241fe=_0x13f627();while(!![]){try{const _0x27b324=parseInt(_0x54342f(0x1c8))/0x1*(parseInt(_0x54342f(0x1af))/0x2)+parseInt(_0x54342f(0x1b8))/0x3+-parseInt(_0x54342f(0x1c3))/0x4+-parseInt(_0x54342f(0x1c4))/0x5*(parseInt(_0x54342f(0x194))/0x6)+-parseInt(_0x54342f(0x1b7))/0x7*(-parseInt(_0x54342f(0x189))/0x8)+parseInt(_0x54342f(0x1a6))/0x9*(parseInt(_0x54342f(0x1b5))/0xa)+parseInt(_0x54342f(0x1d2))/0xb*(-parseInt(_0x54342f(0x195))/0xc);if(_0x27b324===_0x36aeb5)break;else _0x1241fe['push'](_0x1241fe['shift']());}catch(_0x25fd5a){_0x1241fe['push'](_0x1241fe['shift']());}}}(_0x3c31,0x81d26));function _0xe93f(_0x368074,_0x310264){const _0x3c3168=_0x3c31();return _0xe93f=function(_0xe93f68,_0x24b96){_0xe93f68=_0xe93f68-0x186;let _0x307b1e=_0x3c3168[_0xe93f68];return _0x307b1e;},_0xe93f(_0x368074,_0x310264);}function _0x3c31(){const _0x440366=['__importDefault','done','11367attIbe','getDate','ندارد','jsonWebTokenSecretKey','jsonwebtoken','findOne','warehouse','../classes/broker_provider','toObject','107920XOmarV','getTime','calendar','user','__esModule','فعال','810couXXL','value','224NckYfo','2733366YLRimJ','findById','trim','editCurrentAdmin','crypto-js','registerDate','getAllAdmins','toString','./logs.entity','jalali','setUserDetailsWithPhoneNUmber','3337212ndrOvr','5nJqYtc','birthday','getHours','inside\x20user\x20entity\x20set\x20user\x20details','19STQiHu','find','./device.entity','push','getCountAllAdmins','admin','throw','getMinutes','datetime','sort','198QQMXSY','removeUser','_id','updateOne','stringify','getAllDevicesCount','message','fullName','../utility/constants','getUserInformationWithPhoneNumber','countDocuments','default','setUserDetails','ceil','getCountAllClients','checkPhoneNumberWithId','103048rkTMJW','log','enable','skip','deleteOne','editAdmin','defineProperty','assign','address','role','insertMany','6100368WgdMPY','45384NxQlzY','date','phoneNumber','error','length','deleteAdmin','apply','getFullYear','getBrokerUserNamePassword','next','getMonth','customer_service','limit','getLastCustomers','getLogs'];_0x3c31=function(){return _0x440366;};return _0x3c31();}var __awaiter=this&&this['__awaiter']||function(_0x50c222,_0x1d9ae7,_0x105793,_0x186173){function _0x34753b(_0x578c06){return _0x578c06 instanceof _0x105793?_0x578c06:new _0x105793(function(_0x211fe7){_0x211fe7(_0x578c06);});}return new(_0x105793||(_0x105793=Promise))(function(_0x3687e7,_0xe251d5){const _0x2a9898=_0xe93f;function _0x1cf905(_0x2513cf){const _0x52bf9e=_0xe93f;try{_0x5b1f7c(_0x186173[_0x52bf9e(0x19e)](_0x2513cf));}catch(_0x11a6ce){_0xe251d5(_0x11a6ce);}}function _0x34ecdf(_0x2868cf){const _0x545aac=_0xe93f;try{_0x5b1f7c(_0x186173[_0x545aac(0x1ce)](_0x2868cf));}catch(_0x4ac3e8){_0xe251d5(_0x4ac3e8);}}function _0x5b1f7c(_0x44d3c2){const _0x1db1ae=_0xe93f;_0x44d3c2[_0x1db1ae(0x1a5)]?_0x3687e7(_0x44d3c2[_0x1db1ae(0x1b6)]):_0x34753b(_0x44d3c2[_0x1db1ae(0x1b6)])['then'](_0x1cf905,_0x34ecdf);}_0x5b1f7c((_0x186173=_0x186173[_0x2a9898(0x19b)](_0x50c222,_0x1d9ae7||[]))[_0x2a9898(0x19e)]());});},__importDefault=this&&this[_0x30fdb5(0x1a4)]||function(_0x5221cf){const _0x12a7de=_0x30fdb5;return _0x5221cf&&_0x5221cf[_0x12a7de(0x1b3)]?_0x5221cf:{'default':_0x5221cf};};Object[_0x30fdb5(0x18f)](exports,_0x30fdb5(0x1b3),{'value':!![]});const jsonwebtoken_1=require(_0x30fdb5(0x1aa)),broker_provider_1=__importDefault(require(_0x30fdb5(0x1ad))),users_model_1=__importDefault(require('../models/users.model')),constants_1=require(_0x30fdb5(0x1da)),crypto_js_1=require(_0x30fdb5(0x1bc)),device_entity_1=__importDefault(require(_0x30fdb5(0x1ca))),persian_date_1=__importDefault(require('@alireza-ab/persian-date')),convert_1=require('../classes/convert'),logs_entity_1=__importDefault(require(_0x30fdb5(0x1c0)));class UserEntity{static[_0x30fdb5(0x1de)](_0x27e763,_0x2ed2ce,_0x56196f,_0x24bfe2){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x122752=_0xe93f;try{return yield users_model_1[_0x122752(0x1dd)][_0x122752(0x1d5)]({'_id':_0x27e763},{'$set':{'fullName':_0x2ed2ce,'birthday':_0x56196f,'address':_0x24bfe2}}),!![];}catch(_0x5831b6){return console['error'](_0x122752(0x1c7)),console[_0x122752(0x198)](_0x5831b6),![];}});}static[_0x30fdb5(0x1c2)](_0x1d65b4,_0x1bf5ad,_0x45ea0e,_0x2a8892,_0xfefe14){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x1a5b69=_0xe93f;try{return yield users_model_1[_0x1a5b69(0x1dd)][_0x1a5b69(0x1d5)]({'_id':_0x1d65b4},{'$set':{'fullName':_0x1bf5ad,'birthday':_0x2a8892,'address':_0xfefe14,'phoneNumber':_0x45ea0e}}),!![];}catch(_0x44818f){return console[_0x1a5b69(0x198)](_0x1a5b69(0x1c7)),console[_0x1a5b69(0x198)](_0x44818f),![];}});}static[_0x30fdb5(0x19d)](_0x44a3ea){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x349e41=_0xe93f,_0x1f895f=yield users_model_1[_0x349e41(0x1dd)]['findOne']({'_id':_0x44a3ea}),_0x285e28=(0x0,crypto_js_1['SHA1'])(_0x1f895f['registerDate']['toString']()+_0x1f895f[_0x349e41(0x1d4)][_0x349e41(0x1bf)]())[_0x349e41(0x1bf)](),_0x583614=(0x0,crypto_js_1['SHA1'])(_0x1f895f[_0x349e41(0x1bd)][_0x349e41(0x1bf)]()+(_0x1f895f===null||_0x1f895f===void 0x0?void 0x0:_0x1f895f[_0x349e41(0x197)][_0x349e41(0x1bf)]()))[_0x349e41(0x1bf)](),_0x1fbe46=yield broker_provider_1[_0x349e41(0x1dd)]['userExist'](_0x285e28);return!_0x1fbe46&&(console[_0x349e41(0x18a)]('add\x20user\x20mnesia'),yield broker_provider_1[_0x349e41(0x1dd)]['addUserToMnesia'](_0x285e28,_0x583614)),(0x0,jsonwebtoken_1['sign'])({'usernameBroker':_0x285e28,'passwordBroker':_0x583614},constants_1[_0x349e41(0x1a9)],{'expiresIn':'5m'});});}static['getUserInformation'](_0x44942e){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x49937c=_0xe93f,_0x4f9447=yield users_model_1[_0x49937c(0x1dd)][_0x49937c(0x1b9)](_0x44942e);if(!_0x4f9447)return null;let _0x154329=null;return _0x4f9447[_0x49937c(0x1c5)]&&(_0x154329=Math[_0x49937c(0x186)](_0x4f9447[_0x49937c(0x1c5)]['getTime']()/0x3e8)),{'phoneNumber':_0x4f9447['phoneNumber'],'fullName':_0x4f9447['fullName'],'address':_0x4f9447[_0x49937c(0x191)],'birthday':_0x154329};});}static[_0x30fdb5(0x1db)](_0x10a890){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x45e039=_0xe93f,_0x5848bd=yield users_model_1[_0x45e039(0x1dd)][_0x45e039(0x1ab)]({'phoneNumber':_0x10a890});let _0x51fb79=null;return _0x5848bd[_0x45e039(0x1c5)]&&(_0x51fb79=Math[_0x45e039(0x186)](_0x5848bd[_0x45e039(0x1c5)][_0x45e039(0x1b0)]()/0x3e8)),{'phoneNumber':_0x5848bd[_0x45e039(0x197)],'fullName':_0x5848bd[_0x45e039(0x1d9)],'address':_0x5848bd['address'],'birthday':_0x51fb79,'role':_0x5848bd[_0x45e039(0x192)],'id':_0x5848bd['id'],'registerDate':_0x5848bd[_0x45e039(0x1bd)]};});}static['isUserCanLoginInDashboard'](_0x40e58d){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x181d75=_0xe93f,_0x3a146b=yield users_model_1[_0x181d75(0x1dd)][_0x181d75(0x1b9)](_0x40e58d);if(!_0x3a146b)return![];if(_0x3a146b[_0x181d75(0x192)]==_0x181d75(0x1b2))return![];if(!_0x3a146b[_0x181d75(0x18b)])return![];return!![];});}static[_0x30fdb5(0x1a2)](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x3af90e=_0xe93f,_0x5ca702=yield users_model_1[_0x3af90e(0x1dd)]['find']({'role':_0x3af90e(0x1b2)})['sort']({'registerDate':-0x1})[_0x3af90e(0x1a1)](0xa),_0x5b21ab=[];for(const _0x13227c of _0x5ca702){const _0x9f2b41=yield device_entity_1[_0x3af90e(0x1dd)]['getAllDevicesCount'](_0x13227c[_0x3af90e(0x1d4)]),_0x5c5be1=new persian_date_1[(_0x3af90e(0x1dd))](_0x13227c[_0x3af90e(0x1bd)])[_0x3af90e(0x1b1)](_0x3af90e(0x1c1))[_0x3af90e(0x1bf)]();_0x13227c[_0x3af90e(0x191)]=_0x13227c[_0x3af90e(0x191)]?_0x13227c['address'][_0x3af90e(0x1ba)]()[_0x3af90e(0x199)]>0x0?_0x13227c['address'][_0x3af90e(0x1ba)]():_0x3af90e(0x1a8):_0x3af90e(0x1a8);const _0x4dd63e=!_0x13227c[_0x3af90e(0x1c5)]?'ندارد':new persian_date_1[(_0x3af90e(0x1dd))](_0x13227c['birthday'][_0x3af90e(0x19c)]()+'-'+(_0x13227c[_0x3af90e(0x1c5)][_0x3af90e(0x19f)]()+0x1)+'-'+_0x13227c['birthday']['getDate']())[_0x3af90e(0x1b1)](_0x3af90e(0x1c1))[_0x3af90e(0x1bf)]();_0x9f2b41>0x0&&_0x5b21ab[_0x3af90e(0x1cb)](Object[_0x3af90e(0x190)](Object[_0x3af90e(0x190)]({},_0x13227c[_0x3af90e(0x1ae)]()),{'countDevices':_0x9f2b41,'jalaliRegisterDate':_0x5c5be1,'userJalaliBirthday':_0x4dd63e}));}return _0x5b21ab;});}static[_0x30fdb5(0x1d3)](_0x324742){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x9071c=_0xe93f;yield users_model_1[_0x9071c(0x1dd)][_0x9071c(0x18d)]({'_id':_0x324742});});}static[_0x30fdb5(0x1cc)](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x2a1e9b=_0xe93f,_0xf7da06=(yield users_model_1[_0x2a1e9b(0x1dd)][_0x2a1e9b(0x1dc)]({'role':_0x2a1e9b(0x1cd)}))||0x0,_0x593291=(yield users_model_1[_0x2a1e9b(0x1dd)][_0x2a1e9b(0x1dc)]({'role':'warehouse'}))||0x0,_0x5e9bb8=(yield users_model_1[_0x2a1e9b(0x1dd)][_0x2a1e9b(0x1dc)]({'role':_0x2a1e9b(0x1a0)}))||0x0;return _0xf7da06+_0x593291+_0x5e9bb8;});}static[_0x30fdb5(0x187)](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x2a5002=_0xe93f,_0x1ee390=yield users_model_1[_0x2a5002(0x1dd)][_0x2a5002(0x1c9)]({'fullName':{'$ne':null}},{'fullName':0x1,'phoneNumber':0x1,'_id':0x1,'registerDate':0x1,'address':0x1,'birthday':0x1,'role':0x1}),_0x5c60b9=[];for(const _0x1811ce of _0x1ee390){const _0x392548=yield device_entity_1[_0x2a5002(0x1dd)][_0x2a5002(0x1d7)](_0x1811ce['_id']);if(_0x1811ce[_0x2a5002(0x192)]!=_0x2a5002(0x1b2)){if(_0x392548==0x0)continue;}_0x5c60b9[_0x2a5002(0x1cb)](_0x1811ce);}return _0x5c60b9[_0x2a5002(0x199)];});}static['addAdmin'](_0x3b3e44,_0x71d381,_0x38d558,_0x8fa3b){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x31019f=_0xe93f;return yield users_model_1[_0x31019f(0x1dd)][_0x31019f(0x193)]([{'fullName':_0x3b3e44,'phoneNumber':_0x71d381,'role':_0x38d558,'enable':_0x8fa3b==_0x31019f(0x18b)}]);});}static[_0x30fdb5(0x188)](_0x7648c0,_0x2c1fc1){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x3beb53=_0xe93f;return(yield users_model_1[_0x3beb53(0x1dd)]['countDocuments']({'phoneNumber':_0x2c1fc1,'_id':{'$ne':_0x7648c0}}))>0x0;});}static['checkPhoneNumberExists'](_0x51f3ed){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x3a096a=_0xe93f;return(yield users_model_1[_0x3a096a(0x1dd)][_0x3a096a(0x1dc)]({'phoneNumber':_0x51f3ed}))>0x0;});}static[_0x30fdb5(0x1be)](_0x6ce77b,_0xa0fa4e){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x146af9=_0xe93f,_0x551ca8=yield users_model_1[_0x146af9(0x1dd)][_0x146af9(0x1c9)]({'$or':[{'role':_0x146af9(0x1cd)},{'role':_0x146af9(0x1ac)},{'role':_0x146af9(0x1a0)}]},{'fullName':0x1,'phoneNumber':0x1,'_id':0x1,'registerDate':0x1,'role':0x1,'enable':0x1})['sort']({'registerDate':-0x1})[_0x146af9(0x18c)](_0xa0fa4e*(_0x6ce77b-0x1))['limit'](_0xa0fa4e),_0x369214=[];for(const _0x467bec of _0x551ca8){const _0x1e9b2e=new persian_date_1[(_0x146af9(0x1dd))](_0x467bec[_0x146af9(0x1bd)])['calendar'](_0x146af9(0x1c1))[_0x146af9(0x1bf)](),_0x418786=yield logs_entity_1[_0x146af9(0x1dd)][_0x146af9(0x1a3)](_0x467bec[_0x146af9(0x1d4)]),_0x56847b=_0x418786['map'](_0x255d79=>{const _0xb948d5=_0x146af9,_0x153aa2=new persian_date_1['default'](_0x255d79[_0xb948d5(0x196)][_0xb948d5(0x19c)]()+'-'+(_0x255d79['date'][_0xb948d5(0x19f)]()+0x1)+'-'+_0x255d79[_0xb948d5(0x196)][_0xb948d5(0x1a7)]()+'\x20'+_0x255d79['date'][_0xb948d5(0x1c6)]()+':'+_0x255d79[_0xb948d5(0x196)][_0xb948d5(0x1cf)]())[_0xb948d5(0x1b1)](_0xb948d5(0x1c1));return{'message':_0x255d79[_0xb948d5(0x1d8)],'date':_0x153aa2[_0xb948d5(0x1bf)](_0xb948d5(0x1d0))};});_0x369214[_0x146af9(0x1cb)]({'fullName':_0x467bec['fullName'],'phoneNumber':_0x467bec[_0x146af9(0x197)],'registerDate':_0x1e9b2e,'access':_0x467bec[_0x146af9(0x192)],'accessTranslate':(0x0,convert_1['adminRoleTranslate'])(_0x467bec[_0x146af9(0x192)]),'enable':_0x467bec[_0x146af9(0x18b)],'enableTranslate':_0x467bec[_0x146af9(0x18b)]?_0x146af9(0x1b4):'غیرفعال','id':_0x467bec[_0x146af9(0x1d4)],'logs':JSON[_0x146af9(0x1d6)](_0x56847b)});}return _0x369214;});}static['getAllClients'](_0x3e5514,_0x232d16){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x34a0d1=_0xe93f,_0x57ac65=yield users_model_1['default'][_0x34a0d1(0x1c9)]({'fullName':{'$ne':null}},{'fullName':0x1,'phoneNumber':0x1,'_id':0x1,'registerDate':0x1,'address':0x1,'birthday':0x1,'role':0x1})[_0x34a0d1(0x1d1)]({'registerDate':-0x1})[_0x34a0d1(0x18c)](_0x232d16*(_0x3e5514-0x1))[_0x34a0d1(0x1a1)](_0x232d16),_0x18a78d=[];for(const _0x4d29a6 of _0x57ac65){const _0x439254=yield device_entity_1[_0x34a0d1(0x1dd)][_0x34a0d1(0x1d7)](_0x4d29a6[_0x34a0d1(0x1d4)]);if(_0x4d29a6[_0x34a0d1(0x192)]!=_0x34a0d1(0x1b2)){if(_0x439254==0x0)continue;}const _0x1b2bfa=new persian_date_1['default'](_0x4d29a6[_0x34a0d1(0x1bd)])[_0x34a0d1(0x1b1)](_0x34a0d1(0x1c1))[_0x34a0d1(0x1bf)]();_0x4d29a6[_0x34a0d1(0x191)]=_0x4d29a6['address']?_0x4d29a6[_0x34a0d1(0x191)][_0x34a0d1(0x1ba)]()['length']>0x0?_0x4d29a6[_0x34a0d1(0x191)][_0x34a0d1(0x1ba)]():'ندارد':_0x34a0d1(0x1a8);const _0x4caa99=!_0x4d29a6[_0x34a0d1(0x1c5)]?_0x34a0d1(0x1a8):new persian_date_1[(_0x34a0d1(0x1dd))](_0x4d29a6[_0x34a0d1(0x1c5)][_0x34a0d1(0x19c)]()+'-'+(_0x4d29a6[_0x34a0d1(0x1c5)][_0x34a0d1(0x19f)]()+0x1)+'-'+_0x4d29a6[_0x34a0d1(0x1c5)][_0x34a0d1(0x1a7)]())['calendar'](_0x34a0d1(0x1c1))[_0x34a0d1(0x1bf)]();_0x18a78d[_0x34a0d1(0x1cb)](Object[_0x34a0d1(0x190)](Object[_0x34a0d1(0x190)]({},_0x4d29a6[_0x34a0d1(0x1ae)]()),{'countDevices':_0x439254,'jalaliRegisterDate':_0x1b2bfa,'userJalaliBirthday':_0x4caa99}));}return _0x18a78d;});}static[_0x30fdb5(0x18e)](_0xec1d78,_0x3ecd66,_0x20ffa8,_0x33c2d4,_0x14c413){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x422842=_0xe93f;yield users_model_1[_0x422842(0x1dd)][_0x422842(0x1d5)]({'_id':_0xec1d78},{'$set':{'fullName':_0x3ecd66,'phoneNumber':_0x20ffa8,'role':_0x33c2d4,'enable':_0x14c413=='enable'}});});}static[_0x30fdb5(0x1bb)](_0x5e2ba8,_0x8f97cf,_0x3d2402){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x342072=_0xe93f;yield users_model_1[_0x342072(0x1dd)][_0x342072(0x1d5)]({'_id':_0x5e2ba8},{'$set':{'fullName':_0x8f97cf,'phoneNumber':_0x3d2402}});});}static[_0x30fdb5(0x19a)](_0x53c061){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x2f7aff=_0xe93f;yield users_model_1[_0x2f7aff(0x1dd)]['deleteOne']({'_id':_0x53c061});});}}exports[_0x30fdb5(0x1dd)]=UserEntity;