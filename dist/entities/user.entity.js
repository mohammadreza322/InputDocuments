'use strict';function _0x2b53(){const _0x49d2d6=['_id','45qYsQZq','deleteOne','insertMany','231asMhMv','__awaiter','getAllDevicesCount','trim','removeUser','next','then','birthday','getTime','stringify','default','warehouse','__esModule','8oewUoS','750584hDdPQh','jalali','fullName','date','customer_service','admin','9664317twlqpY','toString','length','getLastCustomers','log','throw','user','sort','calendar','getBrokerUserNamePassword','./device.entity','done','10540873tiubee','غیرفعال','../classes/broker_provider','./logs.entity','countDocuments','find','add\x20user\x20mnesia','6682kMIVTY','value','getDate','فعال','setUserDetailsWithPhoneNUmber','1266888UrhDLW','push','3odZcXd','getMinutes','phoneNumber','checkPhoneNumberWithId','updateOne','../classes/convert','ceil','toObject','6719115OdyUrL','datetime','ندارد','role','findOne','inside\x20user\x20entity\x20set\x20user\x20details','findById','getAllAdmins','getUserInformation','getUserInformationWithPhoneNumber','editCurrentAdmin','enable','getMonth','registerDate','getCountAllAdmins','getAllClients','crypto-js','skip','115990PyqWmD','jsonWebTokenSecretKey','error','defineProperty','message','assign','map','@alireza-ab/persian-date','limit','getFullYear','address'];_0x2b53=function(){return _0x49d2d6;};return _0x2b53();}const _0x62a921=_0x6941;(function(_0x3797ec,_0x3a3a90){const _0x3ba3cb=_0x6941,_0x5fb3cf=_0x3797ec();while(!![]){try{const _0xa3bfd5=-parseInt(_0x3ba3cb(0x15b))/0x1*(parseInt(_0x3ba3cb(0x185))/0x2)+-parseInt(_0x3ba3cb(0x18c))/0x3*(parseInt(_0x3ba3cb(0x16c))/0x4)+parseInt(_0x3ba3cb(0x13d))/0x5+-parseInt(_0x3ba3cb(0x18a))/0x6+parseInt(_0x3ba3cb(0x17e))/0x7+parseInt(_0x3ba3cb(0x16b))/0x8*(-parseInt(_0x3ba3cb(0x172))/0x9)+parseInt(_0x3ba3cb(0x14f))/0xa*(-parseInt(_0x3ba3cb(0x15e))/0xb);if(_0xa3bfd5===_0x3a3a90)break;else _0x5fb3cf['push'](_0x5fb3cf['shift']());}catch(_0x171e3c){_0x5fb3cf['push'](_0x5fb3cf['shift']());}}}(_0x2b53,0xf005b));var __awaiter=this&&this[_0x62a921(0x15f)]||function(_0x5de13b,_0x241014,_0x2a5772,_0x200f72){function _0x37e1f5(_0x8bb562){return _0x8bb562 instanceof _0x2a5772?_0x8bb562:new _0x2a5772(function(_0x3fb265){_0x3fb265(_0x8bb562);});}return new(_0x2a5772||(_0x2a5772=Promise))(function(_0x11cce1,_0x5c4264){const _0x4d1aae=_0x6941;function _0x17796a(_0x1951a5){const _0x9d31c5=_0x6941;try{_0x16af8f(_0x200f72[_0x9d31c5(0x163)](_0x1951a5));}catch(_0x5cb513){_0x5c4264(_0x5cb513);}}function _0x4ceee2(_0x21fd09){const _0x5cef92=_0x6941;try{_0x16af8f(_0x200f72[_0x5cef92(0x177)](_0x21fd09));}catch(_0x1ef955){_0x5c4264(_0x1ef955);}}function _0x16af8f(_0x23c6c9){const _0x31f802=_0x6941;_0x23c6c9[_0x31f802(0x17d)]?_0x11cce1(_0x23c6c9[_0x31f802(0x186)]):_0x37e1f5(_0x23c6c9[_0x31f802(0x186)])[_0x31f802(0x164)](_0x17796a,_0x4ceee2);}_0x16af8f((_0x200f72=_0x200f72['apply'](_0x5de13b,_0x241014||[]))[_0x4d1aae(0x163)]());});},__importDefault=this&&this['__importDefault']||function(_0x2f7eee){const _0x888fe7=_0x62a921;return _0x2f7eee&&_0x2f7eee[_0x888fe7(0x16a)]?_0x2f7eee:{'default':_0x2f7eee};};Object[_0x62a921(0x152)](exports,_0x62a921(0x16a),{'value':!![]});const jsonwebtoken_1=require('jsonwebtoken'),broker_provider_1=__importDefault(require(_0x62a921(0x180))),users_model_1=__importDefault(require('../models/users.model')),constants_1=require('../utility/constants'),crypto_js_1=require(_0x62a921(0x14d)),device_entity_1=__importDefault(require(_0x62a921(0x17c))),persian_date_1=__importDefault(require(_0x62a921(0x156))),convert_1=require(_0x62a921(0x191)),logs_entity_1=__importDefault(require(_0x62a921(0x181)));function _0x6941(_0x47ccd6,_0x209f7d){const _0x2b53dc=_0x2b53();return _0x6941=function(_0x694114,_0x3d52ea){_0x694114=_0x694114-0x13b;let _0x26f4cb=_0x2b53dc[_0x694114];return _0x26f4cb;},_0x6941(_0x47ccd6,_0x209f7d);}class UserEntity{static['setUserDetails'](_0x103d5d,_0x26536d,_0x251b09,_0x346880){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x2d8e45=_0x6941;try{return yield users_model_1[_0x2d8e45(0x168)][_0x2d8e45(0x190)]({'_id':_0x103d5d},{'$set':{'fullName':_0x26536d,'birthday':_0x251b09,'address':_0x346880}}),!![];}catch(_0x3019ea){return console[_0x2d8e45(0x151)](_0x2d8e45(0x142)),console[_0x2d8e45(0x151)](_0x3019ea),![];}});}static[_0x62a921(0x189)](_0x2ceffb,_0x14481a,_0x46d0c2,_0x6a532c,_0x40af47){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x384e23=_0x6941;try{return yield users_model_1['default'][_0x384e23(0x190)]({'_id':_0x2ceffb},{'$set':{'fullName':_0x14481a,'birthday':_0x6a532c,'address':_0x40af47,'phoneNumber':_0x46d0c2}}),!![];}catch(_0x3a00f0){return console[_0x384e23(0x151)](_0x384e23(0x142)),console[_0x384e23(0x151)](_0x3a00f0),![];}});}static[_0x62a921(0x17b)](_0x229cef){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x45f5e2=_0x6941,_0x363a06=yield users_model_1[_0x45f5e2(0x168)][_0x45f5e2(0x141)]({'_id':_0x229cef}),_0x413af0=(0x0,crypto_js_1['SHA1'])(_0x363a06[_0x45f5e2(0x14a)][_0x45f5e2(0x173)]()+_0x363a06[_0x45f5e2(0x15a)]['toString']())[_0x45f5e2(0x173)](),_0x431543=(0x0,crypto_js_1['SHA1'])(_0x363a06[_0x45f5e2(0x14a)][_0x45f5e2(0x173)]()+(_0x363a06===null||_0x363a06===void 0x0?void 0x0:_0x363a06['phoneNumber'][_0x45f5e2(0x173)]()))[_0x45f5e2(0x173)](),_0x580b98=yield broker_provider_1[_0x45f5e2(0x168)]['userExist'](_0x413af0);return!_0x580b98&&(console[_0x45f5e2(0x176)](_0x45f5e2(0x184)),yield broker_provider_1['default']['addUserToMnesia'](_0x413af0,_0x431543)),(0x0,jsonwebtoken_1['sign'])({'usernameBroker':_0x413af0,'passwordBroker':_0x431543},constants_1[_0x45f5e2(0x150)],{'expiresIn':'5m'});});}static[_0x62a921(0x145)](_0x4a3adc){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x2f653e=_0x6941,_0x1f1602=yield users_model_1['default'][_0x2f653e(0x143)](_0x4a3adc);if(!_0x1f1602)return null;let _0x29edba=null;return _0x1f1602[_0x2f653e(0x165)]&&(_0x29edba=Math[_0x2f653e(0x13b)](_0x1f1602[_0x2f653e(0x165)][_0x2f653e(0x166)]()/0x3e8)),{'phoneNumber':_0x1f1602['phoneNumber'],'fullName':_0x1f1602[_0x2f653e(0x16e)],'address':_0x1f1602[_0x2f653e(0x159)],'birthday':_0x29edba};});}static[_0x62a921(0x146)](_0x5e1cba){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x2c722c=_0x6941,_0x8dd9f6=yield users_model_1['default'][_0x2c722c(0x141)]({'phoneNumber':_0x5e1cba});let _0xd41573=null;return _0x8dd9f6['birthday']&&(_0xd41573=Math[_0x2c722c(0x13b)](_0x8dd9f6['birthday'][_0x2c722c(0x166)]()/0x3e8)),{'phoneNumber':_0x8dd9f6[_0x2c722c(0x18e)],'fullName':_0x8dd9f6['fullName'],'address':_0x8dd9f6[_0x2c722c(0x159)],'birthday':_0xd41573,'role':_0x8dd9f6['role'],'id':_0x8dd9f6['id'],'registerDate':_0x8dd9f6['registerDate']};});}static['isUserCanLoginInDashboard'](_0x3d71f6){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x5a229f=_0x6941,_0x1f09c3=yield users_model_1[_0x5a229f(0x168)]['findById'](_0x3d71f6);if(!_0x1f09c3)return![];if(_0x1f09c3['role']==_0x5a229f(0x178))return![];if(!_0x1f09c3[_0x5a229f(0x148)])return![];return!![];});}static[_0x62a921(0x175)](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x16b5f7=_0x6941,_0x3d4bd1=yield users_model_1[_0x16b5f7(0x168)][_0x16b5f7(0x183)]({'role':_0x16b5f7(0x178)})[_0x16b5f7(0x179)]({'registerDate':-0x1})[_0x16b5f7(0x157)](0xa),_0x9b42be=[];for(const _0x5ec163 of _0x3d4bd1){const _0x4856af=yield device_entity_1['default'][_0x16b5f7(0x160)](_0x5ec163[_0x16b5f7(0x15a)]),_0x5eaaa9=new persian_date_1[(_0x16b5f7(0x168))](_0x5ec163['registerDate'])['calendar'](_0x16b5f7(0x16d))[_0x16b5f7(0x173)]();_0x5ec163[_0x16b5f7(0x159)]=_0x5ec163['address']?_0x5ec163[_0x16b5f7(0x159)][_0x16b5f7(0x161)]()[_0x16b5f7(0x174)]>0x0?_0x5ec163[_0x16b5f7(0x159)][_0x16b5f7(0x161)]():_0x16b5f7(0x13f):_0x16b5f7(0x13f);const _0x63706=!_0x5ec163['birthday']?_0x16b5f7(0x13f):new persian_date_1[(_0x16b5f7(0x168))](_0x5ec163['birthday'][_0x16b5f7(0x158)]()+'-'+(_0x5ec163[_0x16b5f7(0x165)]['getMonth']()+0x1)+'-'+_0x5ec163['birthday'][_0x16b5f7(0x187)]())[_0x16b5f7(0x17a)]('jalali')[_0x16b5f7(0x173)]();_0x4856af>0x0&&_0x9b42be[_0x16b5f7(0x18b)](Object['assign'](Object[_0x16b5f7(0x154)]({},_0x5ec163[_0x16b5f7(0x13c)]()),{'countDevices':_0x4856af,'jalaliRegisterDate':_0x5eaaa9,'userJalaliBirthday':_0x63706}));}return _0x9b42be;});}static[_0x62a921(0x162)](_0x24c719){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x3fa7f5=_0x6941;yield users_model_1[_0x3fa7f5(0x168)]['deleteOne']({'_id':_0x24c719});});}static[_0x62a921(0x14b)](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x1b5f93=_0x6941,_0x5c3621=(yield users_model_1[_0x1b5f93(0x168)]['countDocuments']({'role':'admin'}))||0x0,_0x37f5ff=(yield users_model_1['default'][_0x1b5f93(0x182)]({'role':'warehouse'}))||0x0,_0x367312=(yield users_model_1[_0x1b5f93(0x168)][_0x1b5f93(0x182)]({'role':_0x1b5f93(0x170)}))||0x0;return _0x5c3621+_0x37f5ff+_0x367312;});}static['getCountAllClients'](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x5d3ae6=_0x6941,_0x11e7e9=yield users_model_1[_0x5d3ae6(0x168)][_0x5d3ae6(0x183)]({'fullName':{'$ne':null}},{'fullName':0x1,'phoneNumber':0x1,'_id':0x1,'registerDate':0x1,'address':0x1,'birthday':0x1,'role':0x1}),_0xbd43c3=[];for(const _0x58272c of _0x11e7e9){const _0x265c41=yield device_entity_1['default']['getAllDevicesCount'](_0x58272c[_0x5d3ae6(0x15a)]);if(_0x58272c[_0x5d3ae6(0x140)]!=_0x5d3ae6(0x178)){if(_0x265c41==0x0)continue;}_0xbd43c3[_0x5d3ae6(0x18b)](_0x58272c);}return _0xbd43c3[_0x5d3ae6(0x174)];});}static['addAdmin'](_0x295553,_0x4cc9c0,_0x3ece0e,_0x2c488a){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x11ac2f=_0x6941;return yield users_model_1[_0x11ac2f(0x168)][_0x11ac2f(0x15d)]([{'fullName':_0x295553,'phoneNumber':_0x4cc9c0,'role':_0x3ece0e,'enable':_0x2c488a==_0x11ac2f(0x148)}]);});}static[_0x62a921(0x18f)](_0x38d163,_0x456988){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x2c616f=_0x6941;return(yield users_model_1['default'][_0x2c616f(0x182)]({'phoneNumber':_0x456988,'_id':{'$ne':_0x38d163}}))>0x0;});}static['checkPhoneNumberExists'](_0x466250){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x5899bd=_0x6941;return(yield users_model_1[_0x5899bd(0x168)][_0x5899bd(0x182)]({'phoneNumber':_0x466250}))>0x0;});}static[_0x62a921(0x144)](_0x1779f5,_0x524a68){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x393cb7=_0x6941,_0x474300=yield users_model_1[_0x393cb7(0x168)][_0x393cb7(0x183)]({'$or':[{'role':_0x393cb7(0x171)},{'role':_0x393cb7(0x169)},{'role':_0x393cb7(0x170)}]},{'fullName':0x1,'phoneNumber':0x1,'_id':0x1,'registerDate':0x1,'role':0x1,'enable':0x1})[_0x393cb7(0x179)]({'registerDate':-0x1})[_0x393cb7(0x14e)](_0x524a68*(_0x1779f5-0x1))[_0x393cb7(0x157)](_0x524a68),_0x4cef6e=[];for(const _0x588988 of _0x474300){const _0xe5f30b=new persian_date_1[(_0x393cb7(0x168))](_0x588988[_0x393cb7(0x14a)])[_0x393cb7(0x17a)](_0x393cb7(0x16d))['toString'](),_0x2503a0=yield logs_entity_1[_0x393cb7(0x168)]['getLogs'](_0x588988[_0x393cb7(0x15a)]),_0x226b09=_0x2503a0[_0x393cb7(0x155)](_0x4bc102=>{const _0x526e0d=_0x393cb7,_0x30656c=new persian_date_1['default'](_0x4bc102['date']['getFullYear']()+'-'+(_0x4bc102[_0x526e0d(0x16f)][_0x526e0d(0x149)]()+0x1)+'-'+_0x4bc102[_0x526e0d(0x16f)]['getDate']()+'\x20'+_0x4bc102[_0x526e0d(0x16f)]['getHours']()+':'+_0x4bc102[_0x526e0d(0x16f)][_0x526e0d(0x18d)]())['calendar']('jalali');return{'message':_0x4bc102[_0x526e0d(0x153)],'date':_0x30656c[_0x526e0d(0x173)](_0x526e0d(0x13e))};});_0x4cef6e[_0x393cb7(0x18b)]({'fullName':_0x588988['fullName'],'phoneNumber':_0x588988[_0x393cb7(0x18e)],'registerDate':_0xe5f30b,'access':_0x588988[_0x393cb7(0x140)],'accessTranslate':(0x0,convert_1['adminRoleTranslate'])(_0x588988[_0x393cb7(0x140)]),'enable':_0x588988[_0x393cb7(0x148)],'enableTranslate':_0x588988[_0x393cb7(0x148)]?_0x393cb7(0x188):_0x393cb7(0x17f),'id':_0x588988['_id'],'logs':JSON[_0x393cb7(0x167)](_0x226b09)});}return _0x4cef6e;});}static[_0x62a921(0x14c)](_0x839df,_0x487e89){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x15972c=_0x6941,_0x2074ea=yield users_model_1[_0x15972c(0x168)][_0x15972c(0x183)]({'fullName':{'$ne':null}},{'fullName':0x1,'phoneNumber':0x1,'_id':0x1,'registerDate':0x1,'address':0x1,'birthday':0x1,'role':0x1})[_0x15972c(0x179)]({'registerDate':-0x1})[_0x15972c(0x14e)](_0x487e89*(_0x839df-0x1))[_0x15972c(0x157)](_0x487e89),_0xeaf976=[];for(const _0x3685b4 of _0x2074ea){const _0x1d6b64=yield device_entity_1['default'][_0x15972c(0x160)](_0x3685b4[_0x15972c(0x15a)]);if(_0x3685b4['role']!='user'){if(_0x1d6b64==0x0)continue;}const _0x5d513f=new persian_date_1[(_0x15972c(0x168))](_0x3685b4[_0x15972c(0x14a)])[_0x15972c(0x17a)](_0x15972c(0x16d))['toString']();_0x3685b4['address']=_0x3685b4[_0x15972c(0x159)]?_0x3685b4['address'][_0x15972c(0x161)]()[_0x15972c(0x174)]>0x0?_0x3685b4['address'][_0x15972c(0x161)]():_0x15972c(0x13f):_0x15972c(0x13f);const _0x13835e=!_0x3685b4[_0x15972c(0x165)]?_0x15972c(0x13f):new persian_date_1['default'](_0x3685b4[_0x15972c(0x165)][_0x15972c(0x158)]()+'-'+(_0x3685b4[_0x15972c(0x165)][_0x15972c(0x149)]()+0x1)+'-'+_0x3685b4[_0x15972c(0x165)][_0x15972c(0x187)]())[_0x15972c(0x17a)]('jalali')[_0x15972c(0x173)]();_0xeaf976[_0x15972c(0x18b)](Object[_0x15972c(0x154)](Object['assign']({},_0x3685b4['toObject']()),{'countDevices':_0x1d6b64,'jalaliRegisterDate':_0x5d513f,'userJalaliBirthday':_0x13835e}));}return _0xeaf976;});}static['editAdmin'](_0x16d46a,_0x488afb,_0xe99c3,_0x497a82,_0xfff2a5){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x58dca6=_0x6941;yield users_model_1['default'][_0x58dca6(0x190)]({'_id':_0x16d46a},{'$set':{'fullName':_0x488afb,'phoneNumber':_0xe99c3,'role':_0x497a82,'enable':_0xfff2a5==_0x58dca6(0x148)}});});}static[_0x62a921(0x147)](_0x53a365,_0x238a1e,_0x30e429){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x6dbe71=_0x6941;yield users_model_1[_0x6dbe71(0x168)][_0x6dbe71(0x190)]({'_id':_0x53a365},{'$set':{'fullName':_0x238a1e,'phoneNumber':_0x30e429}});});}static['deleteAdmin'](_0x34b06e){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x45d668=_0x6941;yield users_model_1[_0x45d668(0x168)][_0x45d668(0x15c)]({'_id':_0x34b06e});});}}exports['default']=UserEntity;