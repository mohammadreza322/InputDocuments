'use strict';const _0x39371d=_0x8b10;(function(_0x1ac517,_0x2849e5){const _0x3cc9fb=_0x8b10,_0x56985e=_0x1ac517();while(!![]){try{const _0x6cb33a=-parseInt(_0x3cc9fb(0x110))/0x1*(parseInt(_0x3cc9fb(0x145))/0x2)+-parseInt(_0x3cc9fb(0x106))/0x3*(parseInt(_0x3cc9fb(0x154))/0x4)+-parseInt(_0x3cc9fb(0x123))/0x5+-parseInt(_0x3cc9fb(0x159))/0x6+parseInt(_0x3cc9fb(0x142))/0x7+parseInt(_0x3cc9fb(0x10f))/0x8+parseInt(_0x3cc9fb(0x107))/0x9*(parseInt(_0x3cc9fb(0x14a))/0xa);if(_0x6cb33a===_0x2849e5)break;else _0x56985e['push'](_0x56985e['shift']());}catch(_0x46c946){_0x56985e['push'](_0x56985e['shift']());}}}(_0x14f9,0x50011));function _0x8b10(_0x2ea6b9,_0x173cec){const _0x14f957=_0x14f9();return _0x8b10=function(_0x8b106d,_0x426508){_0x8b106d=_0x8b106d-0xfe;let _0x3dec3b=_0x14f957[_0x8b106d];return _0x3dec3b;},_0x8b10(_0x2ea6b9,_0x173cec);}var __awaiter=this&&this[_0x39371d(0x113)]||function(_0x44e866,_0x3ab896,_0x1fe96e,_0x38c23c){function _0x42118f(_0x4d483e){return _0x4d483e instanceof _0x1fe96e?_0x4d483e:new _0x1fe96e(function(_0x45a628){_0x45a628(_0x4d483e);});}return new(_0x1fe96e||(_0x1fe96e=Promise))(function(_0x4f1f45,_0x41a918){const _0x6113d8=_0x8b10;function _0x48f222(_0x3c96bb){const _0xe3b9dd=_0x8b10;try{_0x39df69(_0x38c23c[_0xe3b9dd(0x114)](_0x3c96bb));}catch(_0x2ba4f0){_0x41a918(_0x2ba4f0);}}function _0x2d0bc5(_0x12e70b){const _0x4283bc=_0x8b10;try{_0x39df69(_0x38c23c[_0x4283bc(0x11b)](_0x12e70b));}catch(_0x534969){_0x41a918(_0x534969);}}function _0x39df69(_0x3d6681){const _0x33dadb=_0x8b10;_0x3d6681[_0x33dadb(0x15a)]?_0x4f1f45(_0x3d6681['value']):_0x42118f(_0x3d6681[_0x33dadb(0x109)])[_0x33dadb(0x111)](_0x48f222,_0x2d0bc5);}_0x39df69((_0x38c23c=_0x38c23c[_0x6113d8(0x12a)](_0x44e866,_0x3ab896||[]))[_0x6113d8(0x114)]());});},__importDefault=this&&this['__importDefault']||function(_0x1bebbc){const _0x10b8c3=_0x39371d;return _0x1bebbc&&_0x1bebbc[_0x10b8c3(0x149)]?_0x1bebbc:{'default':_0x1bebbc};};Object[_0x39371d(0x14f)](exports,'__esModule',{'value':!![]});const jsonwebtoken_1=require('jsonwebtoken'),broker_provider_1=__importDefault(require(_0x39371d(0x10d))),users_model_1=__importDefault(require('../models/users.model')),constants_1=require('../utility/constants'),crypto_js_1=require(_0x39371d(0x102)),device_entity_1=__importDefault(require(_0x39371d(0x150))),persian_date_1=__importDefault(require(_0x39371d(0x138))),convert_1=require('../classes/convert'),logs_entity_1=__importDefault(require(_0x39371d(0x10a)));function _0x14f9(){const _0xd229be=['skip','find','@alireza-ab/persian-date','addUserToMnesia','role','limit','birthday','jalali','user','sign','setUserDetailsWithPhoneNUmber','getFullYear','2523689BSNMQt','countDocuments','customer_service','6742cVjMhJ','enable','SHA1','getMonth','__esModule','17761970nlGsuy','address','toObject','findOne','getCountAllClients','defineProperty','./device.entity','getUserInformation','getUserInformationWithPhoneNumber','trim','4dCyIWX','push','getHours','updateOne','fullName','3461070sRXQMk','done','getTime','deleteAdmin','phoneNumber','userExist','crypto-js','findById','default','getAllDevicesCount','952545gmINBn','9WPGJIT','getLogs','value','./logs.entity','datetime','removeUser','../classes/broker_provider','فعال','879704kTWXdP','181GRvJSg','then','toString','__awaiter','next','length','admin','setUserDetails','getBrokerUserNamePassword','sort','registerDate','throw','غیرفعال','log','getDate','getAllClients','message','assign','inside\x20user\x20entity\x20set\x20user\x20details','2072395qmMXLc','error','add\x20user\x20mnesia','checkPhoneNumberExists','getAllAdmins','stringify','getCountAllAdmins','apply','checkPhoneNumberWithId','getMinutes','deleteOne','date','calendar','ندارد','map','ceil','editCurrentAdmin','_id','warehouse'];_0x14f9=function(){return _0xd229be;};return _0x14f9();}class UserEntity{static[_0x39371d(0x117)](_0x43cb82,_0x3ce2db,_0x48a65b,_0x34fba8){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x3b3461=_0x8b10;try{return yield users_model_1[_0x3b3461(0x104)][_0x3b3461(0x157)]({'_id':_0x43cb82},{'$set':{'fullName':_0x3ce2db,'birthday':_0x48a65b,'address':_0x34fba8}}),!![];}catch(_0xa2e156){return console[_0x3b3461(0x124)](_0x3b3461(0x122)),console[_0x3b3461(0x124)](_0xa2e156),![];}});}static[_0x39371d(0x140)](_0x5b6ee4,_0x4392e4,_0x19e5e3,_0x234234,_0x3a46d8){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x2ecabd=_0x8b10;try{return yield users_model_1[_0x2ecabd(0x104)][_0x2ecabd(0x157)]({'_id':_0x5b6ee4},{'$set':{'fullName':_0x4392e4,'birthday':_0x234234,'address':_0x3a46d8,'phoneNumber':_0x19e5e3}}),!![];}catch(_0x3738b5){return console['error'](_0x2ecabd(0x122)),console[_0x2ecabd(0x124)](_0x3738b5),![];}});}static[_0x39371d(0x118)](_0x4327d7){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x5efbfc=_0x8b10,_0x134ac6=yield users_model_1[_0x5efbfc(0x104)][_0x5efbfc(0x14d)]({'_id':_0x4327d7}),_0x802d10=(0x0,crypto_js_1[_0x5efbfc(0x147)])(_0x134ac6[_0x5efbfc(0x11a)][_0x5efbfc(0x112)]()+_0x134ac6[_0x5efbfc(0x134)][_0x5efbfc(0x112)]())['toString'](),_0x33aa2a=(0x0,crypto_js_1[_0x5efbfc(0x147)])(_0x134ac6[_0x5efbfc(0x11a)][_0x5efbfc(0x112)]()+(_0x134ac6===null||_0x134ac6===void 0x0?void 0x0:_0x134ac6[_0x5efbfc(0x100)][_0x5efbfc(0x112)]()))['toString'](),_0x21fd5f=yield broker_provider_1[_0x5efbfc(0x104)][_0x5efbfc(0x101)](_0x802d10);return!_0x21fd5f&&(console[_0x5efbfc(0x11d)](_0x5efbfc(0x125)),yield broker_provider_1['default'][_0x5efbfc(0x139)](_0x802d10,_0x33aa2a)),(0x0,jsonwebtoken_1[_0x5efbfc(0x13f)])({'usernameBroker':_0x802d10,'passwordBroker':_0x33aa2a},constants_1['jsonWebTokenSecretKey'],{'expiresIn':'5m'});});}static[_0x39371d(0x151)](_0x4080c5){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x4c19ca=_0x8b10,_0x7e48f0=yield users_model_1['default'][_0x4c19ca(0x103)](_0x4080c5);if(!_0x7e48f0)return null;let _0x2f82b2=null;return _0x7e48f0[_0x4c19ca(0x13c)]&&(_0x2f82b2=Math[_0x4c19ca(0x132)](_0x7e48f0[_0x4c19ca(0x13c)][_0x4c19ca(0xfe)]()/0x3e8)),{'phoneNumber':_0x7e48f0[_0x4c19ca(0x100)],'fullName':_0x7e48f0['fullName'],'address':_0x7e48f0[_0x4c19ca(0x14b)],'birthday':_0x2f82b2};});}static[_0x39371d(0x152)](_0x5894ec){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x4fffa5=_0x8b10,_0x511851=yield users_model_1[_0x4fffa5(0x104)][_0x4fffa5(0x14d)]({'phoneNumber':_0x5894ec});let _0x5287d9=null;return _0x511851[_0x4fffa5(0x13c)]&&(_0x5287d9=Math[_0x4fffa5(0x132)](_0x511851[_0x4fffa5(0x13c)][_0x4fffa5(0xfe)]()/0x3e8)),{'phoneNumber':_0x511851['phoneNumber'],'fullName':_0x511851[_0x4fffa5(0x158)],'address':_0x511851[_0x4fffa5(0x14b)],'birthday':_0x5287d9,'role':_0x511851[_0x4fffa5(0x13a)],'id':_0x511851['id'],'registerDate':_0x511851[_0x4fffa5(0x11a)]};});}static['isUserCanLoginInDashboard'](_0x3ca272){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x4db5b6=_0x8b10,_0x2a8a00=yield users_model_1[_0x4db5b6(0x104)][_0x4db5b6(0x103)](_0x3ca272);if(!_0x2a8a00)return![];if(_0x2a8a00[_0x4db5b6(0x13a)]==_0x4db5b6(0x13e))return![];if(!_0x2a8a00[_0x4db5b6(0x146)])return![];return!![];});}static['getLastCustomers'](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x425ade=_0x8b10,_0x16c267=yield users_model_1[_0x425ade(0x104)][_0x425ade(0x137)]({'role':_0x425ade(0x13e)})[_0x425ade(0x119)]({'registerDate':-0x1})[_0x425ade(0x13b)](0xa),_0x2c4d34=[];for(const _0x47cb81 of _0x16c267){const _0xfe55f0=yield device_entity_1[_0x425ade(0x104)][_0x425ade(0x105)](_0x47cb81[_0x425ade(0x134)]),_0x319821=new persian_date_1[(_0x425ade(0x104))](_0x47cb81[_0x425ade(0x11a)])[_0x425ade(0x12f)](_0x425ade(0x13d))[_0x425ade(0x112)]();_0x47cb81[_0x425ade(0x14b)]=_0x47cb81['address']?_0x47cb81[_0x425ade(0x14b)][_0x425ade(0x153)]()['length']>0x0?_0x47cb81[_0x425ade(0x14b)][_0x425ade(0x153)]():_0x425ade(0x130):_0x425ade(0x130);const _0x4e516e=!_0x47cb81[_0x425ade(0x13c)]?_0x425ade(0x130):new persian_date_1['default'](_0x47cb81[_0x425ade(0x13c)][_0x425ade(0x141)]()+'-'+(_0x47cb81['birthday'][_0x425ade(0x148)]()+0x1)+'-'+_0x47cb81['birthday'][_0x425ade(0x11e)]())['calendar']('jalali')[_0x425ade(0x112)]();_0xfe55f0>0x0&&_0x2c4d34[_0x425ade(0x155)](Object['assign'](Object[_0x425ade(0x121)]({},_0x47cb81[_0x425ade(0x14c)]()),{'countDevices':_0xfe55f0,'jalaliRegisterDate':_0x319821,'userJalaliBirthday':_0x4e516e}));}return _0x2c4d34;});}static[_0x39371d(0x10c)](_0x4ee725){return __awaiter(this,void 0x0,void 0x0,function*(){const _0xbf0a2e=_0x8b10;yield users_model_1['default'][_0xbf0a2e(0x12d)]({'_id':_0x4ee725});});}static[_0x39371d(0x129)](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x184acd=_0x8b10,_0x7e6c32=(yield users_model_1[_0x184acd(0x104)][_0x184acd(0x143)]({'role':'admin'}))||0x0,_0x47cd25=(yield users_model_1[_0x184acd(0x104)][_0x184acd(0x143)]({'role':_0x184acd(0x135)}))||0x0,_0x372628=(yield users_model_1[_0x184acd(0x104)][_0x184acd(0x143)]({'role':_0x184acd(0x144)}))||0x0;return _0x7e6c32+_0x47cd25+_0x372628;});}static[_0x39371d(0x14e)](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x8768d0=_0x8b10,_0x4a2fd1=yield users_model_1[_0x8768d0(0x104)][_0x8768d0(0x137)]({'fullName':{'$ne':null}},{'fullName':0x1,'phoneNumber':0x1,'_id':0x1,'registerDate':0x1,'address':0x1,'birthday':0x1,'role':0x1}),_0x87a4f8=[];for(const _0x284396 of _0x4a2fd1){const _0x115525=yield device_entity_1[_0x8768d0(0x104)][_0x8768d0(0x105)](_0x284396[_0x8768d0(0x134)]);if(_0x284396[_0x8768d0(0x13a)]!=_0x8768d0(0x13e)){if(_0x115525==0x0)continue;}_0x87a4f8[_0x8768d0(0x155)](_0x284396);}return _0x87a4f8[_0x8768d0(0x115)];});}static['addAdmin'](_0x11234c,_0xb1ca67,_0x1ce41f,_0x4841bc){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x3acbb0=_0x8b10;return yield users_model_1[_0x3acbb0(0x104)]['insertMany']([{'fullName':_0x11234c,'phoneNumber':_0xb1ca67,'role':_0x1ce41f,'enable':_0x4841bc==_0x3acbb0(0x146)}]);});}static[_0x39371d(0x12b)](_0x2dcb12,_0x138883){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x46f3b2=_0x8b10;return(yield users_model_1[_0x46f3b2(0x104)]['countDocuments']({'phoneNumber':_0x138883,'_id':{'$ne':_0x2dcb12}}))>0x0;});}static[_0x39371d(0x126)](_0x119107){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x396c07=_0x8b10;return(yield users_model_1[_0x396c07(0x104)][_0x396c07(0x143)]({'phoneNumber':_0x119107}))>0x0;});}static[_0x39371d(0x127)](_0x1c331c,_0x40c14f){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x521aea=_0x8b10,_0x562263=yield users_model_1[_0x521aea(0x104)][_0x521aea(0x137)]({'$or':[{'role':_0x521aea(0x116)},{'role':_0x521aea(0x135)},{'role':_0x521aea(0x144)}]},{'fullName':0x1,'phoneNumber':0x1,'_id':0x1,'registerDate':0x1,'role':0x1,'enable':0x1})[_0x521aea(0x119)]({'registerDate':-0x1})[_0x521aea(0x136)](_0x40c14f*(_0x1c331c-0x1))[_0x521aea(0x13b)](_0x40c14f),_0x113065=[];for(const _0x18ab9f of _0x562263){const _0x89c422=new persian_date_1[(_0x521aea(0x104))](_0x18ab9f[_0x521aea(0x11a)])[_0x521aea(0x12f)](_0x521aea(0x13d))[_0x521aea(0x112)](),_0x54046e=yield logs_entity_1[_0x521aea(0x104)][_0x521aea(0x108)](_0x18ab9f[_0x521aea(0x134)]),_0x1d12be=_0x54046e[_0x521aea(0x131)](_0x4e3b0d=>{const _0xffb9f1=_0x521aea,_0x15d333=new persian_date_1['default'](_0x4e3b0d['date'][_0xffb9f1(0x141)]()+'-'+(_0x4e3b0d[_0xffb9f1(0x12e)]['getMonth']()+0x1)+'-'+_0x4e3b0d[_0xffb9f1(0x12e)][_0xffb9f1(0x11e)]()+'\x20'+_0x4e3b0d[_0xffb9f1(0x12e)][_0xffb9f1(0x156)]()+':'+_0x4e3b0d['date'][_0xffb9f1(0x12c)]())[_0xffb9f1(0x12f)](_0xffb9f1(0x13d));return{'message':_0x4e3b0d[_0xffb9f1(0x120)],'date':_0x15d333[_0xffb9f1(0x112)](_0xffb9f1(0x10b))};});_0x113065[_0x521aea(0x155)]({'fullName':_0x18ab9f['fullName'],'phoneNumber':_0x18ab9f['phoneNumber'],'registerDate':_0x89c422,'access':_0x18ab9f[_0x521aea(0x13a)],'accessTranslate':(0x0,convert_1['adminRoleTranslate'])(_0x18ab9f[_0x521aea(0x13a)]),'enable':_0x18ab9f[_0x521aea(0x146)],'enableTranslate':_0x18ab9f['enable']?_0x521aea(0x10e):_0x521aea(0x11c),'id':_0x18ab9f['_id'],'logs':JSON[_0x521aea(0x128)](_0x1d12be)});}return _0x113065;});}static[_0x39371d(0x11f)](_0x2898e0,_0x48cf59){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x5e2b76=_0x8b10,_0x5d6a1f=yield users_model_1[_0x5e2b76(0x104)]['find']({'fullName':{'$ne':null}},{'fullName':0x1,'phoneNumber':0x1,'_id':0x1,'registerDate':0x1,'address':0x1,'birthday':0x1,'role':0x1})[_0x5e2b76(0x119)]({'registerDate':-0x1})['skip'](_0x48cf59*(_0x2898e0-0x1))['limit'](_0x48cf59),_0x56e2c9=[];for(const _0x380b5d of _0x5d6a1f){const _0x10d2d0=yield device_entity_1['default'][_0x5e2b76(0x105)](_0x380b5d[_0x5e2b76(0x134)]);if(_0x380b5d[_0x5e2b76(0x13a)]!=_0x5e2b76(0x13e)){if(_0x10d2d0==0x0)continue;}const _0xf7278e=new persian_date_1['default'](_0x380b5d['registerDate'])[_0x5e2b76(0x12f)]('jalali')[_0x5e2b76(0x112)]();_0x380b5d['address']=_0x380b5d[_0x5e2b76(0x14b)]?_0x380b5d['address'][_0x5e2b76(0x153)]()[_0x5e2b76(0x115)]>0x0?_0x380b5d[_0x5e2b76(0x14b)][_0x5e2b76(0x153)]():_0x5e2b76(0x130):_0x5e2b76(0x130);const _0x50e6b3=!_0x380b5d['birthday']?_0x5e2b76(0x130):new persian_date_1[(_0x5e2b76(0x104))](_0x380b5d[_0x5e2b76(0x13c)][_0x5e2b76(0x141)]()+'-'+(_0x380b5d[_0x5e2b76(0x13c)][_0x5e2b76(0x148)]()+0x1)+'-'+_0x380b5d['birthday']['getDate']())['calendar'](_0x5e2b76(0x13d))[_0x5e2b76(0x112)]();_0x56e2c9[_0x5e2b76(0x155)](Object[_0x5e2b76(0x121)](Object[_0x5e2b76(0x121)]({},_0x380b5d[_0x5e2b76(0x14c)]()),{'countDevices':_0x10d2d0,'jalaliRegisterDate':_0xf7278e,'userJalaliBirthday':_0x50e6b3}));}return _0x56e2c9;});}static['editAdmin'](_0x4e9a0f,_0x3250a7,_0x1a79a7,_0x4cbfa6,_0x460daa){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x1a6db5=_0x8b10;yield users_model_1[_0x1a6db5(0x104)][_0x1a6db5(0x157)]({'_id':_0x4e9a0f},{'$set':{'fullName':_0x3250a7,'phoneNumber':_0x1a79a7,'role':_0x4cbfa6,'enable':_0x460daa==_0x1a6db5(0x146)}});});}static[_0x39371d(0x133)](_0x3cbd0c,_0x43098e,_0x4793e8){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x1caa54=_0x8b10;yield users_model_1[_0x1caa54(0x104)]['updateOne']({'_id':_0x3cbd0c},{'$set':{'fullName':_0x43098e,'phoneNumber':_0x4793e8}});});}static[_0x39371d(0xff)](_0x17932a){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x4d1173=_0x8b10;yield users_model_1[_0x4d1173(0x104)]['deleteOne']({'_id':_0x17932a});});}}exports[_0x39371d(0x104)]=UserEntity;