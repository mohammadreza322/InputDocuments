'use strict';const _0x432422=_0x59a6;(function(_0x387a13,_0x6e3531){const _0x300b6c=_0x59a6,_0x479e39=_0x387a13();while(!![]){try{const _0x3bb8dc=-parseInt(_0x300b6c(0x1c3))/0x1+parseInt(_0x300b6c(0x1af))/0x2+-parseInt(_0x300b6c(0x1d2))/0x3+parseInt(_0x300b6c(0x1de))/0x4+parseInt(_0x300b6c(0x1ca))/0x5+-parseInt(_0x300b6c(0x1df))/0x6+parseInt(_0x300b6c(0x1dd))/0x7;if(_0x3bb8dc===_0x6e3531)break;else _0x479e39['push'](_0x479e39['shift']());}catch(_0xbb5d3f){_0x479e39['push'](_0x479e39['shift']());}}}(_0x21c3,0xe3d62));function _0x59a6(_0x17160d,_0x4dfa3b){const _0x21c392=_0x21c3();return _0x59a6=function(_0x59a65b,_0x351cfe){_0x59a65b=_0x59a65b-0x188;let _0x18c91d=_0x21c392[_0x59a65b];return _0x18c91d;},_0x59a6(_0x17160d,_0x4dfa3b);}var __awaiter=this&&this[_0x432422(0x1b3)]||function(_0xeb3019,_0x2cd7b0,_0x4e1dd2,_0x83865){function _0x52bf32(_0x58e216){return _0x58e216 instanceof _0x4e1dd2?_0x58e216:new _0x4e1dd2(function(_0x3d7032){_0x3d7032(_0x58e216);});}return new(_0x4e1dd2||(_0x4e1dd2=Promise))(function(_0x11b353,_0x1b9e5f){const _0x40d488=_0x59a6;function _0x164c15(_0x9d1ef5){const _0x22e0d4=_0x59a6;try{_0x6a4c18(_0x83865[_0x22e0d4(0x193)](_0x9d1ef5));}catch(_0x13a329){_0x1b9e5f(_0x13a329);}}function _0x3e3a66(_0x560e35){const _0x31a129=_0x59a6;try{_0x6a4c18(_0x83865[_0x31a129(0x18e)](_0x560e35));}catch(_0x3fc67e){_0x1b9e5f(_0x3fc67e);}}function _0x6a4c18(_0x1c49d7){const _0x36d63c=_0x59a6;_0x1c49d7[_0x36d63c(0x1ac)]?_0x11b353(_0x1c49d7['value']):_0x52bf32(_0x1c49d7[_0x36d63c(0x1b5)])[_0x36d63c(0x1b7)](_0x164c15,_0x3e3a66);}_0x6a4c18((_0x83865=_0x83865[_0x40d488(0x18b)](_0xeb3019,_0x2cd7b0||[]))['next']());});},__importDefault=this&&this[_0x432422(0x195)]||function(_0x131ab2){const _0x414948=_0x432422;return _0x131ab2&&_0x131ab2[_0x414948(0x194)]?_0x131ab2:{'default':_0x131ab2};};Object[_0x432422(0x188)](exports,'__esModule',{'value':!![]});const jsonwebtoken_1=require(_0x432422(0x19a)),broker_provider_1=__importDefault(require(_0x432422(0x1d3))),users_model_1=__importDefault(require(_0x432422(0x19c))),constants_1=require(_0x432422(0x1d8)),crypto_js_1=require(_0x432422(0x1ce)),device_entity_1=__importDefault(require('./device.entity')),persian_date_1=__importDefault(require('@alireza-ab/persian-date')),convert_1=require(_0x432422(0x19f)),logs_entity_1=__importDefault(require(_0x432422(0x18a)));function _0x21c3(){const _0x4501b6=['toString','find','role','getAllDevicesCount','findOne','getFullYear','done','deleteAdmin','checkPhoneNumberWithId','2623270HOPcuh','checkPhoneNumberExists','getLastCustomers','isUserCanLoginInDashboard','__awaiter','getTime','value','customer_service','then','sort','message','push','ندارد','jsonWebTokenSecretKey','fullName','calendar','editAdmin','SHA1','countDocuments','getMonth','1124736jLvOFC','log','add\x20user\x20mnesia','deleteOne','default','datetime','map','3294110GOofAr','getUserInformationWithPhoneNumber','getDate','getCountAllAdmins','crypto-js','registerDate','getLogs','error','3159255WwlqnC','../classes/broker_provider','user','trim','findById','setUserDetailsWithPhoneNUmber','../utility/constants','admin','assign','address','getHours','12087306djlclc','981792YVxJIp','4989744SwgZvy','jalali','defineProperty','stringify','./logs.entity','apply','length','getAllClients','throw','addUserToMnesia','editCurrentAdmin','birthday','phoneNumber','next','__esModule','__importDefault','getMinutes','enable','_id','date','jsonwebtoken','inside\x20user\x20entity\x20set\x20user\x20details','../models/users.model','limit','toObject','../classes/convert','ceil','getBrokerUserNamePassword','updateOne','getAllAdmins','insertMany','sign'];_0x21c3=function(){return _0x4501b6;};return _0x21c3();}class UserEntity{static['setUserDetails'](_0x3120f6,_0x33c5e9,_0x11d442,_0x302aad){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x2871b1=_0x59a6;try{return yield users_model_1[_0x2871b1(0x1c7)][_0x2871b1(0x1a2)]({'_id':_0x3120f6},{'$set':{'fullName':_0x33c5e9,'birthday':_0x11d442,'address':_0x302aad}}),!![];}catch(_0x4f132e){return console[_0x2871b1(0x1d1)]('inside\x20user\x20entity\x20set\x20user\x20details'),console[_0x2871b1(0x1d1)](_0x4f132e),![];}});}static[_0x432422(0x1d7)](_0xd96da9,_0x5dc235,_0x1aa746,_0x5388f7,_0x45b98e){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x4dca19=_0x59a6;try{return yield users_model_1[_0x4dca19(0x1c7)][_0x4dca19(0x1a2)]({'_id':_0xd96da9},{'$set':{'fullName':_0x5dc235,'birthday':_0x5388f7,'address':_0x45b98e,'phoneNumber':_0x1aa746}}),!![];}catch(_0x197d7f){return console[_0x4dca19(0x1d1)](_0x4dca19(0x19b)),console[_0x4dca19(0x1d1)](_0x197d7f),![];}});}static[_0x432422(0x1a1)](_0x49da37){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x28266d=_0x59a6,_0x3eaef4=yield users_model_1[_0x28266d(0x1c7)][_0x28266d(0x1aa)]({'_id':_0x49da37}),_0x1eeb9b=(0x0,crypto_js_1[_0x28266d(0x1c0)])(_0x3eaef4[_0x28266d(0x1cf)]['toString']()+_0x3eaef4[_0x28266d(0x198)][_0x28266d(0x1a6)]())[_0x28266d(0x1a6)](),_0x485cde=(0x0,crypto_js_1['SHA1'])(_0x3eaef4['registerDate'][_0x28266d(0x1a6)]()+(_0x3eaef4===null||_0x3eaef4===void 0x0?void 0x0:_0x3eaef4[_0x28266d(0x192)]['toString']()))['toString'](),_0x2ef8c9=yield broker_provider_1[_0x28266d(0x1c7)]['userExist'](_0x1eeb9b);return!_0x2ef8c9&&(console[_0x28266d(0x1c4)](_0x28266d(0x1c5)),yield broker_provider_1[_0x28266d(0x1c7)][_0x28266d(0x18f)](_0x1eeb9b,_0x485cde)),(0x0,jsonwebtoken_1[_0x28266d(0x1a5)])({'usernameBroker':_0x1eeb9b,'passwordBroker':_0x485cde},constants_1[_0x28266d(0x1bc)],{'expiresIn':'5m'});});}static['getUserInformation'](_0x189af2){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x48370d=_0x59a6,_0xec6b67=yield users_model_1['default']['findById'](_0x189af2);if(!_0xec6b67)return null;let _0x4cafe6=null;return _0xec6b67[_0x48370d(0x191)]&&(_0x4cafe6=Math['ceil'](_0xec6b67[_0x48370d(0x191)][_0x48370d(0x1b4)]()/0x3e8)),{'phoneNumber':_0xec6b67[_0x48370d(0x192)],'fullName':_0xec6b67[_0x48370d(0x1bd)],'address':_0xec6b67[_0x48370d(0x1db)],'birthday':_0x4cafe6};});}static[_0x432422(0x1cb)](_0x1d93d8){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x23c937=_0x59a6,_0x3cea13=yield users_model_1[_0x23c937(0x1c7)][_0x23c937(0x1aa)]({'phoneNumber':_0x1d93d8});let _0x2035c8=null;return _0x3cea13[_0x23c937(0x191)]&&(_0x2035c8=Math[_0x23c937(0x1a0)](_0x3cea13['birthday']['getTime']()/0x3e8)),{'phoneNumber':_0x3cea13[_0x23c937(0x192)],'fullName':_0x3cea13[_0x23c937(0x1bd)],'address':_0x3cea13[_0x23c937(0x1db)],'birthday':_0x2035c8,'role':_0x3cea13['role'],'id':_0x3cea13['id'],'registerDate':_0x3cea13['registerDate']};});}static[_0x432422(0x1b2)](_0xaff192){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x4786a9=_0x59a6,_0x10c2d5=yield users_model_1[_0x4786a9(0x1c7)][_0x4786a9(0x1d6)](_0xaff192);if(!_0x10c2d5)return![];if(_0x10c2d5['role']==_0x4786a9(0x1d4))return![];if(!_0x10c2d5[_0x4786a9(0x197)])return![];return!![];});}static[_0x432422(0x1b1)](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x4b11e0=_0x59a6,_0x391ff5=yield users_model_1[_0x4b11e0(0x1c7)][_0x4b11e0(0x1a7)]({'role':_0x4b11e0(0x1d4)})[_0x4b11e0(0x1b8)]({'registerDate':-0x1})[_0x4b11e0(0x19d)](0xa),_0x36eac2=[];for(const _0x539a0e of _0x391ff5){const _0x5e5668=yield device_entity_1[_0x4b11e0(0x1c7)]['getAllDevicesCount'](_0x539a0e[_0x4b11e0(0x198)]),_0x1e7920=new persian_date_1['default'](_0x539a0e[_0x4b11e0(0x1cf)])['calendar']('jalali')[_0x4b11e0(0x1a6)]();_0x539a0e[_0x4b11e0(0x1db)]=_0x539a0e[_0x4b11e0(0x1db)]?_0x539a0e[_0x4b11e0(0x1db)][_0x4b11e0(0x1d5)]()[_0x4b11e0(0x18c)]>0x0?_0x539a0e[_0x4b11e0(0x1db)][_0x4b11e0(0x1d5)]():'ندارد':_0x4b11e0(0x1bb);const _0x4de883=!_0x539a0e[_0x4b11e0(0x191)]?_0x4b11e0(0x1bb):new persian_date_1[(_0x4b11e0(0x1c7))](_0x539a0e[_0x4b11e0(0x191)][_0x4b11e0(0x1ab)]()+'-'+(_0x539a0e[_0x4b11e0(0x191)][_0x4b11e0(0x1c2)]()+0x1)+'-'+_0x539a0e[_0x4b11e0(0x191)][_0x4b11e0(0x1cc)]())[_0x4b11e0(0x1be)](_0x4b11e0(0x1e0))['toString']();_0x5e5668>0x0&&_0x36eac2[_0x4b11e0(0x1ba)](Object[_0x4b11e0(0x1da)](Object[_0x4b11e0(0x1da)]({},_0x539a0e[_0x4b11e0(0x19e)]()),{'countDevices':_0x5e5668,'jalaliRegisterDate':_0x1e7920,'userJalaliBirthday':_0x4de883}));}return _0x36eac2;});}static['removeUser'](_0x3aa207){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x58dd0d=_0x59a6;yield users_model_1[_0x58dd0d(0x1c7)][_0x58dd0d(0x1c6)]({'_id':_0x3aa207});});}static[_0x432422(0x1cd)](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x5410d4=_0x59a6,_0x5f120f=(yield users_model_1[_0x5410d4(0x1c7)][_0x5410d4(0x1c1)]({'role':_0x5410d4(0x1d9)}))||0x0,_0x5e3ae1=(yield users_model_1[_0x5410d4(0x1c7)][_0x5410d4(0x1c1)]({'role':'warehouse'}))||0x0,_0x1f3bc4=(yield users_model_1[_0x5410d4(0x1c7)]['countDocuments']({'role':_0x5410d4(0x1b6)}))||0x0;return _0x5f120f+_0x5e3ae1+_0x1f3bc4;});}static['getCountAllClients'](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x50a47e=_0x59a6,_0x1d336e=yield users_model_1[_0x50a47e(0x1c7)][_0x50a47e(0x1a7)]({'fullName':{'$ne':null}},{'fullName':0x1,'phoneNumber':0x1,'_id':0x1,'registerDate':0x1,'address':0x1,'birthday':0x1,'role':0x1}),_0x4e57cf=[];for(const _0x57e5b7 of _0x1d336e){const _0x507b84=yield device_entity_1[_0x50a47e(0x1c7)][_0x50a47e(0x1a9)](_0x57e5b7[_0x50a47e(0x198)]);if(_0x57e5b7[_0x50a47e(0x1a8)]!=_0x50a47e(0x1d4)){if(_0x507b84==0x0)continue;}_0x4e57cf[_0x50a47e(0x1ba)](_0x57e5b7);}return _0x4e57cf['length'];});}static['addAdmin'](_0x3cb135,_0x47f003,_0x5457b1,_0x160882){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x13de19=_0x59a6;return yield users_model_1[_0x13de19(0x1c7)][_0x13de19(0x1a4)]([{'fullName':_0x3cb135,'phoneNumber':_0x47f003,'role':_0x5457b1,'enable':_0x160882==_0x13de19(0x197)}]);});}static[_0x432422(0x1ae)](_0x152110,_0x32c5ae){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x1eb9dd=_0x59a6;return(yield users_model_1[_0x1eb9dd(0x1c7)]['countDocuments']({'phoneNumber':_0x32c5ae,'_id':{'$ne':_0x152110}}))>0x0;});}static[_0x432422(0x1b0)](_0x299994){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x17028f=_0x59a6;return(yield users_model_1[_0x17028f(0x1c7)][_0x17028f(0x1c1)]({'phoneNumber':_0x299994}))>0x0;});}static[_0x432422(0x1a3)](_0x548dc0,_0x1ebdbf){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x1eb3a8=_0x59a6,_0x5b208b=yield users_model_1['default'][_0x1eb3a8(0x1a7)]({'$or':[{'role':_0x1eb3a8(0x1d9)},{'role':'warehouse'},{'role':'customer_service'}]},{'fullName':0x1,'phoneNumber':0x1,'_id':0x1,'registerDate':0x1,'role':0x1,'enable':0x1})[_0x1eb3a8(0x1b8)]({'registerDate':-0x1})['skip'](_0x1ebdbf*(_0x548dc0-0x1))[_0x1eb3a8(0x19d)](_0x1ebdbf),_0x488891=[];for(const _0x10456f of _0x5b208b){const _0x19a66d=new persian_date_1[(_0x1eb3a8(0x1c7))](_0x10456f['registerDate'])[_0x1eb3a8(0x1be)](_0x1eb3a8(0x1e0))[_0x1eb3a8(0x1a6)](),_0x532a78=yield logs_entity_1[_0x1eb3a8(0x1c7)][_0x1eb3a8(0x1d0)](_0x10456f[_0x1eb3a8(0x198)]),_0x17cbdb=_0x532a78[_0x1eb3a8(0x1c9)](_0x252b65=>{const _0x3f32a4=_0x1eb3a8,_0x346ab3=new persian_date_1[(_0x3f32a4(0x1c7))](_0x252b65[_0x3f32a4(0x199)]['getFullYear']()+'-'+(_0x252b65[_0x3f32a4(0x199)][_0x3f32a4(0x1c2)]()+0x1)+'-'+_0x252b65[_0x3f32a4(0x199)][_0x3f32a4(0x1cc)]()+'\x20'+_0x252b65[_0x3f32a4(0x199)][_0x3f32a4(0x1dc)]()+':'+_0x252b65[_0x3f32a4(0x199)][_0x3f32a4(0x196)]())[_0x3f32a4(0x1be)](_0x3f32a4(0x1e0));return{'message':_0x252b65[_0x3f32a4(0x1b9)],'date':_0x346ab3[_0x3f32a4(0x1a6)](_0x3f32a4(0x1c8))};});_0x488891[_0x1eb3a8(0x1ba)]({'fullName':_0x10456f[_0x1eb3a8(0x1bd)],'phoneNumber':_0x10456f['phoneNumber'],'registerDate':_0x19a66d,'access':_0x10456f[_0x1eb3a8(0x1a8)],'accessTranslate':(0x0,convert_1['adminRoleTranslate'])(_0x10456f[_0x1eb3a8(0x1a8)]),'enable':_0x10456f[_0x1eb3a8(0x197)],'enableTranslate':_0x10456f[_0x1eb3a8(0x197)]?'فعال':'غیرفعال','id':_0x10456f[_0x1eb3a8(0x198)],'logs':JSON[_0x1eb3a8(0x189)](_0x17cbdb)});}return _0x488891;});}static[_0x432422(0x18d)](_0x26bd84,_0x5d7bc0){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x3d371b=_0x59a6,_0x415b83=yield users_model_1[_0x3d371b(0x1c7)]['find']({'fullName':{'$ne':null}},{'fullName':0x1,'phoneNumber':0x1,'_id':0x1,'registerDate':0x1,'address':0x1,'birthday':0x1,'role':0x1})[_0x3d371b(0x1b8)]({'registerDate':-0x1})['skip'](_0x5d7bc0*(_0x26bd84-0x1))[_0x3d371b(0x19d)](_0x5d7bc0),_0x1d8bf8=[];for(const _0x4d6554 of _0x415b83){const _0x21d1b4=yield device_entity_1[_0x3d371b(0x1c7)][_0x3d371b(0x1a9)](_0x4d6554[_0x3d371b(0x198)]);if(_0x4d6554[_0x3d371b(0x1a8)]!=_0x3d371b(0x1d4)){if(_0x21d1b4==0x0)continue;}const _0x43af55=new persian_date_1['default'](_0x4d6554[_0x3d371b(0x1cf)])[_0x3d371b(0x1be)](_0x3d371b(0x1e0))['toString']();_0x4d6554[_0x3d371b(0x1db)]=_0x4d6554[_0x3d371b(0x1db)]?_0x4d6554['address'][_0x3d371b(0x1d5)]()[_0x3d371b(0x18c)]>0x0?_0x4d6554[_0x3d371b(0x1db)][_0x3d371b(0x1d5)]():_0x3d371b(0x1bb):'ندارد';const _0x59117d=!_0x4d6554[_0x3d371b(0x191)]?'ندارد':new persian_date_1['default'](_0x4d6554[_0x3d371b(0x191)][_0x3d371b(0x1ab)]()+'-'+(_0x4d6554[_0x3d371b(0x191)]['getMonth']()+0x1)+'-'+_0x4d6554[_0x3d371b(0x191)][_0x3d371b(0x1cc)]())[_0x3d371b(0x1be)](_0x3d371b(0x1e0))[_0x3d371b(0x1a6)]();_0x1d8bf8[_0x3d371b(0x1ba)](Object[_0x3d371b(0x1da)](Object[_0x3d371b(0x1da)]({},_0x4d6554[_0x3d371b(0x19e)]()),{'countDevices':_0x21d1b4,'jalaliRegisterDate':_0x43af55,'userJalaliBirthday':_0x59117d}));}return _0x1d8bf8;});}static[_0x432422(0x1bf)](_0x139c3e,_0x4edcfc,_0x2fbcf7,_0x27a6c5,_0x37d0ac){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x482b09=_0x59a6;yield users_model_1[_0x482b09(0x1c7)][_0x482b09(0x1a2)]({'_id':_0x139c3e},{'$set':{'fullName':_0x4edcfc,'phoneNumber':_0x2fbcf7,'role':_0x27a6c5,'enable':_0x37d0ac==_0x482b09(0x197)}});});}static[_0x432422(0x190)](_0xbe174,_0x7a55dd,_0x29c49d){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x119ea9=_0x59a6;yield users_model_1['default'][_0x119ea9(0x1a2)]({'_id':_0xbe174},{'$set':{'fullName':_0x7a55dd,'phoneNumber':_0x29c49d}});});}static[_0x432422(0x1ad)](_0x5f1436){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x2fe710=_0x59a6;yield users_model_1[_0x2fe710(0x1c7)][_0x2fe710(0x1c6)]({'_id':_0x5f1436});});}}exports['default']=UserEntity;